# Pgpool UI Redesign - Quick Reference

## What Was Changed?

### 1. OpsRequest Create UI (`opskubedbcom-pgpoolopsrequest-editor/create-ui.yaml`)

**Before ‚Üí After Examples:**

#### Horizontal Scaling
```yaml
# BEFORE (Old)
- type: input
  label: Node
  schema: .../horizontalScaling/properties/node

# AFTER (New)
- type: horizontal-layout
  elements:
    - type: input-compare
      header: Node
      label: Node
      subtitle: Define the total number of PgPool nodes for your database...
      init:
        type: func
        value: setValueFromDbDetails|/spec/replicas
      schema: .../horizontalScaling/properties/node
    - type: info
      hasIcon: true
      label: Each PgPool node acts as a connection pooler and load balancer...
```

#### Vertical Scaling
```yaml
# BEFORE (Old)
- type: machine-compare
  label: Resources
  loader: getMachines
  
# AFTER (New)
- type: machine-compare
  label: Resources
  subtitle: Compare your current machine configuration with the proposed memory adjustments...
  loader: getMachines
  init:
    type: func
    value: setMachine
  watcher:
    func: onMachineChange|node|/spec/podTemplate/spec/containers
```

#### Reconfigure
```yaml
# BEFORE (Old)
- type: radio
  label: Reconfigure Type
  options: [...]

# AFTER (New)
- type: radio
  label: Reconfigure Type
  subtitle: Choose the action you'd like to perform. Select a new configuration secret...
  validation:
    type: required
  options: [...]
  
# Changed from textarea to editor
- type: editor        # Was: type: textarea
  label: value
  hasCopy: false
```

### 2. Pgpool Edit UI (`kubedbcom-pgpool-editor/edit-ui.yaml`)

**Before ‚Üí After Examples:**

#### Trigger Field
```yaml
# BEFORE (Old)
- type: select
  label: Trigger
  options:
    - text: 'On'
      value: 'On'
    - text: 'Off'
      value: 'Off'

# AFTER (New)
- type: switch
  label: Trigger
  fullwidth: true
  init:
    type: func
    value: setTrigger|...
  watcher:
    func: onTriggerChange|compute/pgpool
```

#### Pod Lifetime Threshold
```yaml
# BEFORE (Old)
- type: input
  label: Pod LifeTime Threshold

# AFTER (New)
- type: label-element
  label: Pod lifetime threshold
  subtitle: Specifies the duration a pod can exist before being considered for scaling decisions...
- type: input
  label: Pod LifeTime Threshold (e.g., 10m 30s)
  customClass: width-300
```

#### Resource Configuration
```yaml
# BEFORE (Old)
- type: threshold-input
  label: Resource Diff Percentage

# AFTER (New)
- type: threshold-input
  label: Resource Diff Percentage
  customClass: width-300
- type: label-element
  label: Resource Configuration
  subtitle: Define minimum and maximum allowed resources to ensure optimal database performance
```

#### Monitoring Section
```yaml
# BEFORE (Old)
- type: block-layout
  label: Backup form  # Wrong label!
  
- type: radio
  label: Select a Monitoring Method
  options:
    - text: Custom Scrapper  # Typo!

# AFTER (New)
- type: block-layout
  label: Monitoring Configuration  # Fixed!
  
- type: label-element
  label: Monitoring Method Selection
  subtitle: Choose the monitoring approach that best fits your infrastructure...
  
- type: radio
  label: Select a Monitoring Method
  options:
    - text: Custom Scraper  # Fixed typo!
```

## Key Improvements Summary

### Visual Enhancements
‚úÖ Added 25+ descriptive subtitles across all forms
‚úÖ Changed 4+ select dropdowns to switch toggles  
‚úÖ Added 10+ label-element components for guidance
‚úÖ Added 3+ info components with helpful tips
‚úÖ Added customClass for consistent width (`width-300`)

### UX Improvements
‚úÖ Added format examples in labels (e.g., "10m 30s", "1m (1 minute)")
‚úÖ Better visual hierarchy with horizontal-layout and block-layout
‚úÖ Compare components (input-compare, select-compare, machine-compare)
‚úÖ Changed textarea to editor for code/YAML editing
‚úÖ Added buttonClass styling for array forms

### Content Improvements
‚úÖ Fixed typo: "Scrapper" ‚Üí "Scraper"
‚úÖ Fixed label: "Backup form" ‚Üí "Monitoring Configuration"
‚úÖ Added helpful descriptions to all radio options
‚úÖ Clear guidance for complex fields

### Technical Improvements
‚úÖ Added proper watchers for state management
‚úÖ Better initialization functions
‚úÖ Improved loader function references
‚úÖ Added Container Controlled Values selector

## Functions Already Present (No Changes Needed)

Both `functions.js` files already contained all necessary helper functions:

### OpsRequest Functions.js ‚úÖ
- Database operations: `getDbDetails`, `getDbVersions`, `getDbs`
- Operation types: `ifRequestTypeEqualsTo`, `onRequestTypeChange`
- Machine management: `getMachines`, `setMachine`, `onMachineChange`
- Reconfiguration: `ifReconfigurationTypeEqualsTo`, `onReconfigurationTypeChange`
- TLS: `hasTlsField`, `getIssuerRefsName`, `onTlsOperationChange`
- Validation: `isVerticalScaleTopologyRequired`, `setValueFromDbDetails`

### Editor Functions.js ‚úÖ
- Autoscaling: `setTrigger`, `onTriggerChange`, `showOpsRequestOptions`
- Machine profiles: `setAllowedMachine`, `getMachines`, `onMachineChange`
- Monitoring: `showMonitoringSection`, `onEnableMonitoringChange`, `onAgentChange`
- Node topology: `fetchNodeTopology`, `isNodeTopologySelected`
- Utilities: `setApplyToIfReady`, `hasAnnotations`, `hasNoAnnotations`

## Testing Checklist

### OpsRequest Create UI
- [ ] Select namespace and database
- [ ] UpdateVersion: Compare versions
- [ ] HorizontalScaling: Adjust node count with info tooltip
- [ ] VerticalScaling: Select machine profile, see comparison
- [ ] Reconfigure: Select secret or apply config with YAML editor
- [ ] ReconfigureTLS: Manage certificates
- [ ] Verify all subtitles and info messages display correctly

### Pgpool Edit UI
- [ ] Toggle compute autoscaling trigger (switch)
- [ ] Set pod lifetime threshold with format example
- [ ] Configure min/max resources with machine profiles
- [ ] Set up node topology constraints
- [ ] Configure monitoring with different methods
- [ ] Verify all enhanced labels and subtitles

## Backup Files Location

Original files are safely backed up:
- `charts/opskubedbcom-pgpoolopsrequest-editor/ui/old-create-ui.yaml`
- `charts/kubedbcom-pgpool-editor/ui/old-edit-ui.yaml`

To revert:
```bash
cd charts/opskubedbcom-pgpoolopsrequest-editor/ui
mv create-ui.yaml create-ui-new.yaml
mv old-create-ui.yaml create-ui.yaml

cd ../../kubedbcom-pgpool-editor/ui
mv edit-ui.yaml edit-ui-new.yaml
mv old-edit-ui.yaml edit-ui.yaml
```

## Result

The pgpool UI now provides the same professional, user-friendly experience as MongoDB, with:
- üé® **Better visual design** with consistent layouts
- üìù **Clear guidance** through subtitles and info components
- ‚ö° **Improved interactivity** with switches and compare components
- ‚ú® **Professional polish** matching MongoDB's UX standards
- üîß **No breaking changes** - all functions already in place
