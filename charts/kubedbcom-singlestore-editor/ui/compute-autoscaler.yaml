  - type: single-step-form
    id: storage-autoscaler
    loader: getDbDetails
    elements:
      - type: block-layout
        if:
          type: function
          name: isConsole
        elements:
          - type: input
            label: Name
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/metadata/properties/name
          - type: select
            label: Select Namespace
            loader: getNamespaces
            if:
              type: function
              name: isRancherManaged
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/metadata/properties/namespace
            watcher:
              func: onNamespaceChange
              paths:
                - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/metadata/properties/namespace
          - type: select
            label: Select Db
            loader: getDbs
            validation:
              type: required
            refresh: true
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/databaseRef/properties/name
            watcher:
              func: initMetadata
              paths:
                - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/databaseRef/properties/name

      - type: radio
        if:
          type: function
          name: isConsole
        label: Select Type
        validation:
          type: required
        schema: temp/properties/autoscalingType
        watcher:
          func: initMetadata
          paths:
            - temp/properties/autoscalingType
        options:
          - text: Compute
            value: compute
            description: Scale your CPU Memory based on resource usage
          - text: Storage
            value: storage
            description: Expand your database size based on volume usage

      - type: block-layout
        showLabels: false
        elements:
          # aggregator storage
          - type: block-layout
            label: Aggregator
            if:
              type: function
              name: dbTypeEqualsTo|topology
            showLabels: true
            # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator
            elements:
              - type: select
                label: Trigger
                init:
                  type: func
                  value: setTrigger|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/aggregator/trigger
                options:
                  - text: 'On'
                    value: 'On'
                  - text: 'Off'
                    value: 'Off'
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/trigger
              - type: select
                label: Expansion Mode
                options:
                  - text: Online
                    value: Online
                  - text: Offline
                    value: Offline
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/expansionMode
              - type: input
                label: UsageThreshold (%)
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/usageThreshold
              - type: single-step-form-array
                label: ScalingRules
                addFormLabel: ScalingRules
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/scalingRules
                watcher:
                  func: handleUnit|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/aggregator/scalingRules|scalingRules
                  paths:
                    - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/scalingRules
                tableContents:
                  - inTableColumn: true
                    label: AppliesUpto (In Storage units)
                    path: appliesUpto
                    type: value
                    typeOfValue: string
                  - inTableColumn: true
                    label: Threshold (In %, Or In Storage Units)
                    path: threshold
                    type: value
                    typeOfValue: string
                element:
                  type: single-step-form
                  elements:
                    - type: input
                      label: AppliesUpto (In Storage units)
                      schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/scalingRules/items/properties/appliesUpto
                    - type: input
                      label: Threshold (In %, Or In Storage Units)
                      schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/scalingRules/items/properties/threshold
              - type: input
                label: UpperBound
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/upperBound
                watcher:
                  func: handleUnit|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/aggregator/upperBound
                  paths:
                    - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/upperBound

      - type: block-layout
        showLabels: false
        elements:
          # leaf storage
          - type: block-layout
            label: Leaf
            if:
              type: function
              name: dbTypeEqualsTo|topology
            showLabels: true
            # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf
            elements:
              - type: select
                label: Trigger
                init:
                  type: func
                  value: setTrigger|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/leaf/trigger
                options:
                  - text: 'On'
                    value: 'On'
                  - text: 'Off'
                    value: 'Off'
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/trigger
              - type: select
                label: Expansion Mode
                options:
                  - text: Online
                    value: Online
                  - text: Offline
                    value: Offline
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/expansionMode
              - type: input
                label: UsageThreshold (%)
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/usageThreshold
              - type: single-step-form-array
                label: ScalingRules
                addFormLabel: ScalingRules
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/scalingRules
                watcher:
                  func: handleUnit|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/leaf/scalingRules
                  paths:
                    - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/scalingRules
                tableContents:
                  - inTableColumn: true
                    label: AppliesUpto (In Storage units)
                    path: appliesUpto
                    type: value
                    typeOfValue: string
                  - inTableColumn: true
                    label: Threshold (In %, Or In Storage Units)
                    path: threshold
                    type: value
                    typeOfValue: string
                element:
                  type: single-step-form
                  elements:
                    - type: input
                      label: AppliesUpto (In Storage units)
                      schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/scalingRules/items/properties/appliesUpto
                    - type: input
                      label: Threshold (In %, Or In Storage Units)
                      schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/scalingRules/items/properties/threshold
              - type: input
                label: UpperBound
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/upperBound
                watcher:
                  func: handleUnit|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/leaf/upperBound
                  paths:
                    - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/upperBound

      - type: block-layout
        showLabels: false
        elements:
          # node storage (standalone)
          - type: block-layout
            label: Node
            if:
              type: function
              name: dbTypeEqualsTo|standalone
            showLabels: true
            # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node
            elements:
              - type: select
                label: Trigger
                init:
                  type: func
                  value: setTrigger|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/node/trigger
                options:
                  - text: 'On'
                    value: 'On'
                  - text: 'Off'
                    value: 'Off'
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/trigger
              - type: select
                label: Expansion Mode
                options:
                  - text: Online
                    value: Online
                  - text: Offline
                    value: Offline
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/expansionMode
              - type: input
                label: UsageThreshold (%)
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/usageThreshold
              - type: single-step-form-array
                label: ScalingRules
                addFormLabel: ScalingRules
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/scalingRules
                watcher:
                  func: handleUnit|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/node/scalingRules|scalingRules
                  paths:
                    - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/scalingRules
                tableContents:
                  - inTableColumn: true
                    label: AppliesUpto (In Storage units)
                    path: appliesUpto
                    type: value
                    typeOfValue: string
                  - inTableColumn: true
                    label: Threshold (In %, Or In Storage Units)
                    path: threshold
                    type: value
                    typeOfValue: string
                element:
                  type: single-step-form
                  elements:
                    - type: input
                      label: AppliesUpto (In Storage units)
                      schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/scalingRules/items/properties/appliesUpto
                    - type: input
                      label: Threshold (In %, Or In Storage Units)
                      schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/scalingRules/items/properties/threshold
              - type: input
                label: UpperBound
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/upperBound
                watcher:
                  func: handleUnit|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/node/upperBound
                  paths:
                    - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/upperBound

      - type: block-layout
        label: Ops Request Options
        showLabels: true
        if:
          type: function
          name: showOpsRequestOptions
        # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/opsRequestOptions
        elements:
          - type: select
            label: Timeout
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/opsRequestOptions/properties/timeout
            options:
              - text: 5 minutes
                value: 5m0s
              - text: 10 minutes
                value: 10m0s
              - text: 30 minutes
                value: 30m0s
              - text: 1 hour
                value: 1h0m
              - text: 2 hours
                value: 2h0m
              - text: 5 hours
                value: 5h0m
              - text: 10 hours
                value: 10h0m
          - type: radio
            label: Apply
            init:
              type: func
              value: setApplyToIfReady
            options:
              - text: IfReady (OpsRequest will be applied if database is ready)
                value: IfReady
              - text: Always (OpsRequest will always be applied)
                value: Always
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/opsRequestOptions/properties/apply
