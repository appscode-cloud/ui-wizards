type: multi-step-form
step:
  - type: single-step-form
    id: backupconfiguration
    # label: Backup
    schema: schema/
    elements:
    - type: radio
      label: Schedule a Backup?
      schema: temp/properties/scheduleBackup
      isHorizontal: true
      options:
        - text: 'Yes'
          value: 'yes'
        - text: 'No'
          value: 'no'
      if:
        type: function
        name: showScheduleBackup
      init:
        type: func
        value: initScheduleBackupForEdit
      watcher:
        func: onScheduleBackupChange
        paths:
          - temp/properties/scheduleBackup
    - type: block-layout
      label: Backup Form
      showLabels: false
      loader: initBackupData
      if:
        type: function
        name: showBackupForm
      elements:
        - type: radio
          label: Select Backup Type
          schema: temp/properties/backupType
          isHorizontal: true
          options:
            - text: BackupConfig
              value: BackupConfig
              description: 'Create, Delete or Modify BackupConfig'
            - text: BackupBlueprint
              value: BackupBlueprint
              description: Enable/Disable BackupBlueprint
          if:
            type: function
            name: isBackupDataLoadedTrue
          init:
            type: func
            value: setBackupType
          loader: getTypes
          watcher:
            func: onBackupTypeChange
            paths:
              - temp/properties/backupType
        - type: block-layout
          label: Config
          if:
            type: function
            name: isBackupType|BackupConfig
          elements:
            - type: select
              label: Select Context
              schema: temp/properties/backupConfigContext
              validation:
                type: required
              loader: getContext
              watcher:
                func: onContextChange
                paths:
                  - temp/properties/backupConfigContext
            - type: select
              label: Select BackupConfig
              schema: temp/properties/config
              validation:
                type: required
              if:
                type: function
                name: showConfigList
              loader: getConfigList
              watcher:
                func: onConfigChange
                paths:
                  - temp/properties/config
            - type: input
              label: Schedule
              schema: temp/properties/schedule
              validation:
                type: required
              if:
                type: function
                name: showSchedule
              loader:
                name: getDefaultSchedule|/resources/coreKubestashComBackupConfiguration/spec/sessions
                watchPaths:
                  - temp/properties/config
              watcher:
                func: onInputChangeSchedule|/resources/coreKubestashComBackupConfiguration/spec/sessions|schedule
                paths:
                  - temp/properties/schedule
            - type: switch
              label: Paused
              fullwidth: true
              schema: schema/properties/resources/properties/coreKubestashComBackupConfiguration/properties/spec/properties/paused
              if:
                type: function
                name: showPause
              watcher:
                  func: setPausedValue
                  paths:
                    - temp/properties/config
              init:
                type: func
                value: setPausedValue
        - type: block-layout
          label: Blueprint
          if:
            type: function
            name: isBackupType|BackupBlueprint
          elements:
            - type: switch
              label: Enable Backup Blueprint
              fullwidth: true
              schema: temp/properties/blueprintEnabled
              init:
                type: func
                value: setBlueprintSwitch
              watcher:
                func: onBlueprintChange
                paths:
                  - temp/properties/blueprintEnabled
        - type: block-layout
          label: Archiver
          if:
            type: function
            name: isBackupType|Archiver
          elements:
            - type: switch
              label: Enable Archiver
              fullwidth: true
              schema: temp/properties/archiverEnabled
              init:
                type: func
                value: setArchiverSwitch
              watcher:
                func: onArchiverChange
                paths:
                  - temp/properties/archiverEnabled

  - type: single-step-form
    id: compute-autoscaler
    loader: getDbDetails
    elements:
      - type: block-layout
        if:
          type: function
          name: isConsole
        elements:
          - type: input
            label: Name
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/metadata/properties/name
          - type: select
            label: Select Namespace
            loader: getNamespaces
            if:
              type: function
              name: isRancherManaged
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/metadata/properties/namespace
            watcher:
              func: onNamespaceChange
              paths:
                - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/metadata/properties/namespace
          - type: select
            label: Select Db
            loader: getDbs
            validation:
              type: required
            refresh: true
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/databaseRef/properties/name
            watcher:
              func: initMetadata
              paths:
                - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/databaseRef/properties/name

      - type: radio
        if:
          type: function
          name: isConsole
        label: Select Type
        validation:
          type: required
        schema: temp/properties/autoscalingType
        watcher:
          func: initMetadata
          paths:
            - temp/properties/autoscalingType
        options:
          - text: Compute
            value: compute
            description: Scale your CPU Memory based on resource usage
          - text: Storage
            value: storage
            description: Expand your database size based on volume usage

      - type: block-layout
        label: Topology
        if:
          type: function
          name: dbTypeEqualsTo|topology
        showLabels: false
        # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute
        elements:
          # Aggregator section
          - type: switch
            label: Trigger
            fullwidth: true
            init:
              type: func
              value: setTrigger|autoscalingKubedbComSinglestoreAutoscaler/spec/compute/aggregator/trigger
            schema: temp/properties/compute/properties/aggregator/properties/trigger
            watcher:
              func: onTriggerChange|compute/aggregator
              paths:
                - temp/properties/compute/properties/aggregator/properties/trigger
          - type: label-element
            label: Pod lifetime threshold
            subtitle: Specifies the duration a pod can exist before using considered for scaling decisions, ensuring resource optimization and workload stability
          - type: input
            label: Pod LifeTime Threshold (e.g., 10m 30s)
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/aggregator/properties/podLifeTimeThreshold
            customClass: width-300
          - type: block-layout
            label: Aggregator
            showLabels: true
            # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/aggregator
            elements:
              - type: threshold-input
                label: ResourceDiff Percentage
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/aggregator/properties/resourceDiffPercentage
                customClass: width-300
              - type: label-element
                label: Resource Configuration
                subtitle: Define minimum and maximum allowed resources to ensure optimal database performance
              - type: block-layout
                showLabels: false
                elements:
                  - type: horizontal-layout
                    elements:
                    - type: machine-compare
                      label: Min Allowed Profile
                      schema: temp/properties/allowedMachine-aggregator-min
                      if:
                        type: function
                        name: hasAnnotations
                      init:
                        type: func
                        value: setAllowedMachine|aggregator|min
                      loader:
                        name: getMachines|aggregator|min
                        watchPaths:
                          - temp/properties/topologyMachines
                          - temp/properties/allowedMachine-aggregator-max
                      watcher:
                        func: onMachineChange|aggregator
                        paths:
                          - temp/properties/allowedMachine-aggregator-min
                    - type: block-layout
                      label: Min Allowed
                      fixedBlock: true
                      if:
                        type: function
                        name: hasNoAnnotations
                      showLabels: true
                      elements:
                        - type: input-compare
                          label: Cpu
                          schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/aggregator/properties/minAllowed/properties/cpu
                        - type: input-compare
                          label: Memory
                          schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/aggregator/properties/minAllowed/properties/memory
                    - type: machine-compare
                      label: Max Allowed Profile
                      schema: temp/properties/allowedMachine-aggregator-max
                      if:
                        type: function
                        name: hasAnnotations
                      init:
                        type: func
                        value: setAllowedMachine|aggregator|max
                      loader:
                        name: getMachines|aggregator|max
                        watchPaths:
                          - temp/properties/topologyMachines
                          - temp/properties/allowedMachine-aggregator-min
                      watcher:
                        func: onMachineChange|aggregator
                        paths:
                          - temp/properties/allowedMachine-aggregator-max
                    - type: block-layout
                      label: Max Allowed
                      fixedBlock: true
                      if:
                        type: function
                        name: hasNoAnnotations
                      showLabels: true
                      elements:
                        - type: input-compare
                          label: Cpu
                          schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/aggregator/properties/maxAllowed/properties/cpu
                        - type: input-compare
                          label: Memory
                          schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/aggregator/properties/maxAllowed/properties/memory
              - type: select
                label: Controlled Resources
                loader: setControlledResources|aggregator
                multiple: true
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/aggregator/properties/controlledResources

          # Leaf section
          - type: switch
            label: Trigger
            fullwidth: true
            init:
              type: func
              value: setTrigger|autoscalingKubedbComSinglestoreAutoscaler/spec/compute/leaf/trigger
            schema: temp/properties/compute/properties/leaf/properties/trigger
            watcher:
              func: onTriggerChange|compute/leaf
              paths:
                - temp/properties/compute/properties/leaf/properties/trigger
          - type: label-element
            label: Pod lifetime threshold
            subtitle: Specifies the duration a pod can exist before using considered for scaling decisions, ensuring resource optimization and workload stability
          - type: input
            label: Pod LifeTime Threshold (e.g., 10m 30s)
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/leaf/properties/podLifeTimeThreshold
            customClass: width-300
          - type: block-layout
            label: Leaf
            showLabels: true
            # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/leaf
            elements:
              - type: threshold-input
                label: ResourceDiff Percentage
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/leaf/properties/resourceDiffPercentage
                customClass: width-300
              - type: label-element
                label: Resource Configuration
                subtitle: Define minimum and maximum allowed resources to ensure optimal database performance
              - type: block-layout
                showLabels: false
                elements:
                  - type: horizontal-layout
                    elements:
                    - type: machine-compare
                      label: Min Allowed Profile
                      schema: temp/properties/allowedMachine-leaf-min
                      if:
                        type: function
                        name: hasAnnotations
                      init:
                        type: func
                        value: setAllowedMachine|leaf|min
                      loader:
                        name: getMachines|leaf|min
                        watchPaths:
                          - temp/properties/topologyMachines
                          - temp/properties/allowedMachine-leaf-max
                      watcher:
                        func: onMachineChange|leaf
                        paths:
                          - temp/properties/allowedMachine-leaf-min
                    - type: block-layout
                      label: Min Allowed
                      fixedBlock: true
                      if:
                        type: function
                        name: hasNoAnnotations
                      showLabels: true
                      elements:
                        - type: input-compare
                          label: Cpu
                          schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/leaf/properties/minAllowed/properties/cpu
                        - type: input-compare
                          label: Memory
                          schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/leaf/properties/minAllowed/properties/memory
                    - type: machine-compare
                      label: Max Allowed Profile
                      schema: temp/properties/allowedMachine-leaf-max
                      if:
                        type: function
                        name: hasAnnotations
                      init:
                        type: func
                        value: setAllowedMachine|leaf|max
                      loader:
                        name: getMachines|leaf|max
                        watchPaths:
                          - temp/properties/topologyMachines
                          - temp/properties/allowedMachine-leaf-min
                      watcher:
                        func: onMachineChange|leaf
                        paths:
                          - temp/properties/allowedMachine-leaf-max
                    - type: block-layout
                      label: Max Allowed
                      fixedBlock: true
                      if:
                        type: function
                        name: hasNoAnnotations
                      showLabels: true
                      elements:
                        - type: input-compare
                          label: Cpu
                          schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/leaf/properties/maxAllowed/properties/cpu
                        - type: input-compare
                          label: Memory
                          schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/leaf/properties/maxAllowed/properties/memory
              - type: select
                label: Controlled Resources
                loader: setControlledResources|leaf
                multiple: true
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/leaf/properties/controlledResources

      # combined mode - node only
      - type: block-layout
        label: Combined
        if:
          type: function
          name: dbTypeEqualsTo|standalone
        showLabels: false
        # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute
        elements:
          # Node section
          - type: switch
            label: Trigger
            fullwidth: true
            init:
              type: func
              value: setTrigger|autoscalingKubedbComSinglestoreAutoscaler/spec/compute/node/trigger
            schema: temp/properties/compute/properties/node/properties/trigger
            watcher:
              func: onTriggerChange|compute/node
              paths:
                - temp/properties/compute/properties/node/properties/trigger
          - type: label-element
            label: Pod lifetime threshold
            subtitle: Specifies the duration a pod can exist before using considered for scaling decisions, ensuring resource optimization and workload stability
          - type: input
            label: Pod LifeTime Threshold (e.g., 10m 30s)
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/node/properties/podLifeTimeThreshold
            customClass: width-300
          - type: block-layout
            label: Node
            showLabels: true
            # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/node
            elements:
              - type: threshold-input
                label: ResourceDiff Percentage
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/node/properties/resourceDiffPercentage
                customClass: width-300
              - type: label-element
                label: Resource Configuration
                subtitle: Define minimum and maximum allowed resources to ensure optimal database performance
              - type: block-layout
                showLabels: false
                elements:
                  - type: horizontal-layout
                    elements:
                    - type: machine-compare
                      label: Min Allowed Profile
                      schema: temp/properties/allowedMachine-node-min
                      if:
                        type: function
                        name: hasAnnotations
                      init:
                        type: func
                        value: setAllowedMachine|node|min
                      loader:
                        name: getMachines|node|min
                        watchPaths:
                          - temp/properties/topologyMachines
                          - temp/properties/allowedMachine-node-max
                      watcher:
                        func: onMachineChange|node
                        paths:
                          - temp/properties/allowedMachine-node-min
                    - type: block-layout
                      label: Min Allowed
                      fixedBlock: true
                      if:
                        type: function
                        name: hasNoAnnotations
                      showLabels: true
                      elements:
                        - type: input-compare
                          label: Cpu
                          schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/node/properties/minAllowed/properties/cpu
                        - type: input-compare
                          label: Memory
                          schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/node/properties/minAllowed/properties/memory
                    - type: machine-compare
                      label: Max Allowed Profile
                      schema: temp/properties/allowedMachine-node-max
                      if:
                        type: function
                        name: hasAnnotations
                      init:
                        type: func
                        value: setAllowedMachine|node|max
                      loader:
                        name: getMachines|node|max
                        watchPaths:
                          - temp/properties/topologyMachines
                          - temp/properties/allowedMachine-node-min
                      watcher:
                        func: onMachineChange|node
                        paths:
                          - temp/properties/allowedMachine-node-max
                    - type: block-layout
                      label: Max Allowed
                      fixedBlock: true
                      if:
                        type: function
                        name: hasNoAnnotations
                      showLabels: true
                      elements:
                        - type: input-compare
                          label: Cpu
                          schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/node/properties/maxAllowed/properties/cpu
                        - type: input-compare
                          label: Memory
                          schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/node/properties/maxAllowed/properties/memory
              - type: select
                label: Controlled Resources
                loader: setControlledResources|node
                multiple: true
                schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/node/properties/controlledResources

      - type: block-layout
        label: Node Topology
        if:
          type: function
          name: hasNoAnnotations
        showLabels: true
        # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/nodeTopology
        elements:
          - type: select
            label: Select Node Topology
            loader: fetchNodeTopology
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/nodeTopology/properties/name
          - type: threshold-input
            label: ScaleUp Diff Percentage
            if:
              type: function
              name: isNodeTopologySelected
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/nodeTopology/properties/scaleUpDiffPercentage
          - type: threshold-input
            label: ScaleDown Diff Percentage
            if:
              type: function
              name: isNodeTopologySelected
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/compute/properties/nodeTopology/properties/scaleDownDiffPercentage

      - type: block-layout
        label: Ops Request Options
        showLabels: true
        if:
          type: function
          name: showOpsRequestOptions
        # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/opsRequestOptions
        elements:
          - type: time-picker
            label: Timeout
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/opsRequestOptions/properties/timeout
          - type: radio
            label: Apply
            init:
              type: func
              value: setApplyToIfReady
            options:
              - text: IfReady (OpsRequest will be applied if database is ready)
                value: IfReady
              - text: Always (OpsRequest will always be applied)
                value: Always
            schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/opsRequestOptions/properties/apply

  - type: single-step-form
    id: storage-autoscaler
    loader: getDbDetails
    elements:
    - type: block-layout
      showLabels: false
      elements:
        - type: block-layout
          showLabels: false
          elements:
            # aggregator storage
            - type: switch
              label: Trigger
              fullwidth: true
              if:
                type: function
                name: dbTypeEqualsTo|topology
              init:
                type: func
                value: setTrigger|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/aggregator/trigger
              schema: temp/properties/storage/properties/aggregator/properties/trigger
              watcher:
                func: onTriggerChange|storage/aggregator
                paths:
                  - temp/properties/storage/properties/aggregator/properties/trigger
            - type: label-element
              label: Expansion Mode (Online/Offline)
              subtitle: For Online Mode enables scaling without downtime by dynamically resizing storage while the database remains operational and Offline Mode performs storage scaling during scheduled downtime, ensuring consistency but requiring database restarts.
              if:
                type: function
                name: dbTypeEqualsTo|topology
            - type: select
              label: Mode
              description: Select how the storage expansion should be handled.
              if:
                type: function
                name: dbTypeEqualsTo|topology
              options:
                - text: Online
                  value: Online
                - text: Offline
                  value: Offline
              schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/expansionMode
            - type: block-layout
              label: Aggregator
              if:
                type: function
                name: dbTypeEqualsTo|topology
              showLabels: true
              # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator
              elements:
                - type: threshold-input
                  label: UsageThreshold (%)
                  subtitle: Set the threshold percentage of storage usage to trigger scaling.
                  schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/usageThreshold
                - type: scaling-rules
                  label: Scaling Rules
                  schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/scalingRules
                  loader: setValueFromDbDetails|resources/kubedbComSinglestore/spec/topology/aggregator/storage/resources/requests/storage
                  watcher:
                    func: handleUnit|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/aggregator/scalingRules|scalingRules
                    paths:
                      - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/scalingRules
                - type: input
                  label: Scaling Threshold
                  schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/scalingThreshold
                - type: input
                  label: UpperBound
                  schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/upperBound
                  watcher:
                    func: handleUnit|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/aggregator/upperBound
                    paths:
                      - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/aggregator/properties/upperBound

        - type: block-layout
          showLabels: false
          elements:
            # leaf storage
            - type: switch
              label: Trigger
              fullwidth: true
              if:
                type: function
                name: dbTypeEqualsTo|topology
              init:
                type: func
                value: setTrigger|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/leaf/trigger
              schema: temp/properties/storage/properties/leaf/properties/trigger
              watcher:
                func: onTriggerChange|storage/leaf
                paths:
                  - temp/properties/storage/properties/leaf/properties/trigger
            - type: label-element
              label: Expansion Mode (Online/Offline)
              subtitle: For Online Mode enables scaling without downtime by dynamically resizing storage while the database remains operational and Offline Mode performs storage scaling during scheduled downtime, ensuring consistency but requiring database restarts.
              if:
                type: function
                name: dbTypeEqualsTo|topology
            - type: select
              label: Mode
              description: Select how the storage expansion should be handled.
              if:
                type: function
                name: dbTypeEqualsTo|topology
              options:
                - text: Online
                  value: Online
                - text: Offline
                  value: Offline
              schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/expansionMode
            - type: block-layout
              label: Leaf
              if:
                type: function
                name: dbTypeEqualsTo|topology
              showLabels: true
              # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf
              elements:
                - type: threshold-input
                  label: UsageThreshold (%)
                  subtitle: Set the threshold percentage of storage usage to trigger scaling.
                  schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/usageThreshold
                - type: scaling-rules
                  label: Scaling Rules
                  schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/scalingRules
                  loader: setValueFromDbDetails|resources/kubedbComSinglestore/spec/topology/leaf/storage/resources/requests/storage
                  watcher:
                    func: handleUnit|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/leaf/scalingRules|scalingRules
                    paths:
                      - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/scalingRules
                - type: input
                  label: Scaling Threshold
                  schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/scalingThreshold
                - type: input
                  label: UpperBound
                  schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/upperBound
                  watcher:
                    func: handleUnit|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/leaf/upperBound
                    paths:
                      - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/leaf/properties/upperBound

        - type: block-layout
          showLabels: false
          elements:
            # node storage (standalone)
            - type: switch
              label: Trigger
              fullwidth: true
              if:
                type: function
                name: dbTypeEqualsTo|standalone
              init:
                type: func
                value: setTrigger|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/node/trigger
              schema: temp/properties/storage/properties/node/properties/trigger
              watcher:
                func: onTriggerChange|storage/node
                paths:
                  - temp/properties/storage/properties/node/properties/trigger
            - type: label-element
              label: Expansion Mode (Online/Offline)
              subtitle: For Online Mode enables scaling without downtime by dynamically resizing storage while the database remains operational and Offline Mode performs storage scaling during scheduled downtime, ensuring consistency but requiring database restarts.
              if:
                type: function
                name: dbTypeEqualsTo|standalone
            - type: select
              label: Mode
              description: Select how the storage expansion should be handled.
              if:
                type: function
                name: dbTypeEqualsTo|standalone
              options:
                - text: Online
                  value: Online
                - text: Offline
                  value: Offline
              schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/expansionMode
            - type: block-layout
              label: Node
              if:
                type: function
                name: dbTypeEqualsTo|standalone
              showLabels: true
              # schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node
              elements:
                - type: threshold-input
                  label: UsageThreshold (%)
                  subtitle: Set the threshold percentage of storage usage to trigger scaling.
                  schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/usageThreshold
                - type: scaling-rules
                  label: Scaling Rules
                  schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/scalingRules
                  loader: setValueFromDbDetails|resources/kubedbComSinglestore/spec/storage/resources/requests/storage
                  watcher:
                    func: handleUnit|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/node/scalingRules|scalingRules
                    paths:
                      - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/scalingRules
                - type: input
                  label: Scaling Threshold
                  schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/scalingThreshold
                - type: input
                  label: UpperBound
                  schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/upperBound
                  watcher:
                    func: handleUnit|autoscalingKubedbComSinglestoreAutoscaler/spec/storage/node/upperBound
                    paths:
                      - schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/storage/properties/node/properties/upperBound

        - type: block-layout
          label: OpsRequest Options
          showLabels: true
          if:
            type: function
            name: showOpsRequestOptions
          elements:
            - type: time-picker
              label: Timeout
              schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/opsRequestOptions/properties/timeout
            - type: radio
              label: Apply
              init:
                type: func
                value: setApplyToIfReady
              options:
                - text: IfReady (OpsRequest will be applied if database is ready)
                  value: IfReady
                - text: Always (OpsRequest will always be applied)
                  value: Always
              schema: schema/properties/resources/properties/autoscalingKubedbComSinglestoreAutoscaler/properties/spec/properties/opsRequestOptions/properties/apply
  
  - type: single-step-form
    id: monitoring
    elements:
    - type: label-element
      label: To update Exporter Resource section click on Create OpsRequest
    - type: anchor
      label: Create OpsRequest
      schema: temp/properties/opsRequestUrl
      init:
        type: func
        value: getOpsRequestUrl|VerticalScaling
    - type: switch
      label: Enable Monitoring
      fullwidth: true
      schema: temp/properties/enableMonitoring
      init:
        type: func
        value: isValueExistInModel|/resources/kubedbComSinglestore/spec/monitor
      watcher:
        func: onEnableMonitoringChange
        paths:
          - temp/properties/enableMonitoring
    - type: block-layout
      label: Backup form 
      showLabels: false
      if:
        type: function
        name: showMonitoringSection
      elements:
        - type: radio
          label: Select a Monitoring Method
          schema: schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/agent
          isHorizontal: true
          options:
          - text: Prometheus Operator
            value: prometheus.io/operator
            description: Inject metric exporter sidecar and creates a ServiceMonitor
          - text: Custom ServiceMonitor
            value: prometheus.io
            description: Injects the metric exporter sidecar and let you customize ServiceMonitor
          - text: Custom Scrapper
            value: prometheus.io/builtin
            description: Inject metric exporter sidecar and add Prometheus annotations to the stats Service
          init:
            type: static
            value: prometheus.io/operator
          watcher:
            func: onAgentChange
            paths:
              - schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/agent
        - type: block-layout
          label: ServiceMonitor Configuration  
          showLabels: true 
          if: 
            type: function
            name: isEqualToModelPathValue|prometheus.io/operator|/resources/kubedbComSinglestore/spec/monitor/agent
          elements:
            - label: Scrapping Interval
              schema: schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/serviceMonitor/properties/interval
              type: input 
        - type: block-layout
          label: Service Monitor
          showLabels: true
          if:
            type: function
            name: isEqualToModelPathValue|prometheus.io|/resources/kubedbComSinglestore/spec/monitor/agent
          elements:
          - type: array-object-form
            label: Endpoints
            buttonClass: is-light is-outlined
            schema: schema/properties/resources/properties/monitoringCoreosComServiceMonitor/properties/spec/properties/endpoints
            elements:
            - type: switch
              label: Honor labels
              fullwidth: true
              schema: honorLabels
            - type: input
              label: Interval
              schema: interval
            - type: input
              label: Path
              schema: path
            - type: input
              label: Port
              schema: port
          - type: select
            multiple: true
            label: Match Namespaces
            schema: schema/properties/resources/properties/monitoringCoreosComServiceMonitor/properties/spec/properties/namespaceSelector/properties/matchNames
            loader: getResources|core|v1|namespaces
            if: 
              type: function
              name: returnFalse
          - type: block-layout
            showLabels: false
            # schema: schema/properties/resources/properties/monitoringCoreosComServiceMonitor/properties/spec/properties/selector
            if: 
              type: function
              name: returnFalse
            elements:
              - type: object-item
                label: Labels
                schema: schema/properties/resources/properties/monitoringCoreosComServiceMonitor/properties/spec/properties/selector/properties/matchLabels
        - type: object-item
          schema: schema/properties/resources/properties/monitoringCoreosComServiceMonitor/properties/metadata/properties/labels
          label : Labels
          buttonClass: is-light is-outlined
          if:
            type: function
            name: isEqualToModelPathValue|prometheus.io|/resources/kubedbComSinglestore/spec/monitor/agent
          # individualItemDisabilityCheck: disableLableChecker
        - type: label-element
          label: Exporter Configuration
          schema: ''
        - type: switch
          label: Customize Exporter Sidecar
          fullwidth: true
          schema: temp/properties/customizeExporter
          init:
            type: static
            value: true
          watcher:
            func: onCustomizeExporterChange
            paths:
              - temp/properties/customizeExporter
        - type: block-layout
          label: Customer Exporter Section 
          showLabels: false
          if:
            type: function
            name: showCustomizeExporterSection
          elements:
            - type: machine-compare
              label: Resources
              schema: schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/resources
              if: 
                type: function
                name: returnFalse
            - type: label-element
              label: Security Context
              schema: ''
            - type: input
              schema:  schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/securityContext/properties/runAsUser
              label: Run as User
            - type: input
              schema: schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/securityContext/properties/runAsGroup
              label: Run as Group
            - type: input
              schema: schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/port
              label: Port
            - type: array-item-form
              label: Args
              buttonClass: is-light is-outlined
              schema: schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/args
              init:
                type: static
                value: ['--compatible-mode']
              element:
                type: input
                label: Args
                # isSubsection: true
            - type: block-layout
              label: Metadata
              showLabels: false
              elements: 
                  #remove: should be array-object-form after fixes
                - type: block-layout
                  label: New Environment Variable
                  showLabels: true
                  hideBlock: true
                  # schema: schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/env
                  elements:
                  - type: input
                    label: Name
                    schema: schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/env/properties/items/properties/name
                  - type: radio
                    label: Value From
                    schema: temp/properties/valueFromType
                    init: 
                      type: func 
                      value: setValueFrom
                    options:
                    - text: Input
                      value: input
                    - text: Secret
                      value: secret
                    - text: ConfigMap
                      value: configMap
                    watcher:
                      func: onValueFromChange
                      paths:
                        - temp/properties/valueFromType
                  - type: input 
                    label: Value 
                    schema: schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/env/properties/items/properties/value
                    if:
                      name: isEqualToValueFromType|input
                      type: function
                  - type: select
                    if:
                      type: function
                      name: isEqualToValueFromType|configMap
                    label: ConfigMap Name
                    schema: schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/env/properties/items/properties/valueFrom/properties/configMapKeyRef/properties/name
                    loader:
                      name: resourceNames|core|v1|configmaps
                      watchPaths:
                        - schema/metadata/release/namespace
                    # allowUserDefinedOption: true
                  - type: select
                    label: ConfigMap Key
                    schema: schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/env/properties/items/properties/valueFrom/properties/configMapKeyRef/properties/key
                    if:
                      type: function
                      name: isEqualToValueFromType|configMap
                    loader:
                      name: getConfigMapKeys
                      watchPaths:
                        - schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/env/properties/items/valueFrom/configMapKeyRef/name
                        - schema/metadata/release/namespace
                    # allowUserDefinedOption: true
                  - type: select
                    label: Secret Name
                    schema: schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/env/properties/items/properties/valueFrom/properties/secretKeyRef/properties/name
                    if:
                      type: function
                      name: isEqualToValueFromType|secret
                    loader:
                      name: getSecrets
                      watchPaths:
                        - schema/metadata/release/namespace
                    # allowUserDefinedOption: true
                  - type: select
                    label: Secret Key
                    schema: schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/env/properties/items/properties/valueFrom/properties/secretKeyRef/properties/key
                    if:
                      type: function
                      name: isEqualToValueFromType|secret
                    loader:
                      name: getSecretKeys
                      watchPaths:
                        - schema/properties/resources/properties/kubedbComSinglestore/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/env/properties/items/valueFrom/secretKeyRef/name
                        - schema/metadata/release/namespace
                    # allowUserDefinedOption: true

  - type: single-step-form
    id: binding
    elements:
    - type: switch
      label: Expose Database
      schema: temp/properties/binding
      fullwidth: true
      init:
        type: func
        value: isBindingAlreadyOn
      watcher:
        func: addOrRemoveBinding
        paths:
          - temp/properties/binding