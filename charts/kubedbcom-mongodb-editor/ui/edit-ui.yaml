type: multi-step-form
step:
  - type: single-step-form
    id: backupconfiguration
    # label: Backup
    schema: schema/
    elements:
      - type: radio
        label: Schedule a Backup?
        schema: temp/properties/scheduleBackup
        isHorizontal: true
        options:
          - text: 'Yes'
            value: 'yes'
          - text: 'No'
            value: 'no'
        if:
          type: function
          name: showScheduleBackup
        init:
          type: func
          value: initScheduleBackupForEdit
        watcher:
          func: onScheduleBackupChange
          paths:
            - temp/properties/scheduleBackup
      - type: block-layout
        label: Backup Form
        showLabels: false
        loader: initBackupData
        if:
          type: function
          name: showBackupForm
        elements:
          - type: radio
            label: Select Backup Type
            schema: temp/properties/backupType
            isHorizontal: true
            options:
              - text: BackupConfig
                value: BackupConfig
                description: 'Create, Delete or Modify BackupConfig'
              - text: BackupBlueprint
                value: BackupBlueprint
                description: Enable/Disable BackupBlueprint
            if:
              type: function
              name: isBackupDataLoadedTrue
            init:
              type: func
              value: setBackupType
            loader: getTypes
            watcher:
              func: onBackupTypeChange
              paths:
                - temp/properties/backupType
          - type: block-layout
            label: Config
            if:
              type: function
              name: isBackupType|BackupConfig
            elements:
              - type: select
                label: Select Context
                schema: temp/properties/backupConfigContext
                validation:
                  type: required
                loader: getContext
                watcher:
                  func: onContextChange
                  paths:
                    - temp/properties/backupConfigContext
              - type: select
                label: Select BackupConfig
                schema: temp/properties/config
                validation:
                  type: required
                if:
                  type: function
                  name: showConfigList
                loader: getConfigList
                watcher:
                  func: onConfigChange
                  paths:
                    - temp/properties/config
              - type: input
                label: Schedule
                schema: temp/properties/schedule
                validation:
                  type: required
                if:
                  type: function
                  name: showSchedule
                # loader must be computed
                loader: getDefaultSchedule|/resources/coreKubestashComBackupConfiguration/spec/sessions
                watcher:
                  func: onInputChangeSchedule|/resources/coreKubestashComBackupConfiguration/spec/sessions|schedule
                  paths:
                    - temp/properties/schedule
              - type: switch
                label: Paused
                schema: schema/properties/resources/properties/coreKubestashComBackupConfiguration/properties/spec/properties/paused
                if:
                  type: function
                  name: showPause
          - type: block-layout
            label: Blueprint
            if:
              type: function
              name: isBackupType|BackupBlueprint
            elements:
              - type: switch
                label: Enable Backup Blueprint
                schema: temp/properties/blueprintEnabled
                init:
                  type: func
                  value: setBlueprintSwitch
                watcher:
                  func: onBlueprintChange
                  paths:
                    - temp/properties/blueprintEnabled
          - type: block-layout
            label: Archiver
            if:
              type: function
              name: isBackupType|Archiver
            elements:
              - type: switch
                label: Enable Archiver
                schema: temp/properties/archiverEnabled
                init:
                  type: func
                  value: setArchiverSwitch
                watcher:
                  func: onArchiverChange
                  paths:
                    - temp/properties/archiverEnabled
  - type: single-step-form
    id: monitoring
    elements:
    - type: label-element
      label: To update Exporter Resource section click on Create OpsRequest
      schema: ''
    - type: anchor
      label: Create OpsRequest
      schema: schema/properties/userinfo/properties/link
      # init:
      #   type: func
      #   value: getOpsRequestUrl|VerticalScaling
    - type: switch
      label: Enable Monitoring
      schema: temp/properties/enableMonitoring
      init: 
        type: func
        value: isValueExistInModel|/resources/kubedbComMongoDB/spec/monitor
      watcher:
        func: onEnableMonitoringChange
        paths:
          - temp/properties/enableMonitoring
    - type: block-layout
      label: Backup form 
      showLabels: false
      if:
        type: function
        name: showMonitoringSection
      elements:
        - type: radio
          label: Select a Monitoring Method
          schema: schema/properties/resources/properties/kubedbComMongoDB/properties/spec/properties/monitor/properties/agent
          isHorizontal: true
          options:
          - text: Prometheus Operator
            value: Prometheus-Operator
            description: Inject metric exporter sidecar and creates a ServiceMonitor
          - text: Custom ServiceMonitor
            value: Custom-ServiceMonitor
            description: Injects the metric exporter sidecar and let you customize
          - text: Custom Scrapper
            value: Custom-Scrapper
            description: Inject metric exporter sidecar and add Prometheus annotations to
              the..
          init:
            type: func
            value: setMonitoringModel
          watcher:
            func: onAgentChange
            paths:
              - schema/properties/resources/properties/kubedbComMongoDB/properties/spec/properties/monitor/properties/agent
        - type: block-layout
          label: ServiceMonitor Configuration  
          showLabels: true 
          if: 
            type: function
            name: isEqualToModelPathValue|Prometheus-Operator|/resources/kubedbComMongoDB/spec/monitor/agent
          elements:
            - label: Scrapping Interval
              schema: schema/properties/resources/properties/kubedbComMongoDB/properties/spec/properties/monitor/properties/prometheus/properties/serviceMonitor/properties/interval
              type: input 
        - type: block-layout
          label: Service Monitor
          showLabels: true
          if:
            type: function
            name: isEqualToModelPathValue|Custom-ServiceMonitor
          elements:
          - type: array-object-form
            label: New Endpoint
            schema: schema/properties/resources/properties/monitoringCoreosComServiceMonitor/properties/spec/properties/endpoints
            elements:
            - type: switch
              label: Honor labels
              schema: honorLabels
            - type: input
              label: Interval
              schema: interval
            - type: input
              label: Path
              schema: path
            - type: input
              label: Port
              schema: port
          - type: select
            multiple: true
            label: Match Namespaces
            schema: schema/properties/resources/properties/monitoringCoreosComServiceMonitor/properties/spec/properties/namespaceSelector/properties/matchNames
            loader: getResources|core|v1|namespaces
            if: 
              type: function
              name: returnFalse
          - type: object-item
            schema: schema/properties/resources/properties/monitoringCoreosComServiceMonitor/properties/spec/properties/selector
            label : Labels 
            init: 
              type: static
              value: 
                name: riyad 
                age: 10
            if: 
              type: function
              name: returnFalse
          if:
            type: function
            name: isEqualToModelPathValue|Custom-ServiceMonitor     
        - type: object-item
          schema: schema/properties/resources/properties/monitoringComServiceMonitor/properties/metadata/properties/labels
          label : Labels 
          init: 
            type: static
            value: 
              name: riyad 
              age: 10
          if:
            type: function
            name: isEqualToModelPathValue|Custom-ServiceMonitor 
        - type: label-element
          label: Exporter Configuration
          schema: ''
        - type: switch
          label: Customize Exporter Sidecar
          schema: temp/properties/customizeExporter
          watcher:
            func: onCustomizeExporterChange
            paths: 
              - temp/properties/customizeExporter
        - type: block-layout
          label: 2nd Parameters 
          showLabels: false 
          if:
            type: function
            name: showCustomizeExporterSection
          elements:
            - type: horizontal-layout
              label: Resources
              showLabels: true
              if: 
                type: function
                name: returnFalse
              elements:
                - type: input
                  label: CPU Requests
                  schema: schema/properties/resources/properties/requests/additionalProperties/cpu
                - type: input
                  label: CPU Limits
                  schema: schema/properties/resources/properties/limits/additionalProperties/cpu
                - type: input
                  label: Memory Requests
                  schema: schema/properties/resources/properties/requests/additionalProperties/memory
                - type: input
                  label: Memory Limits
                  schema: schema/properties/resources/properties/limits/additionalProperties/memory
            - type: label-element
              label: Security Context
              schema: ''
            - type: input
              schema:  schema/properties/resources/properties/kubedbComMongoDB/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/securityContext/properties/runAsUser
              label: Run as User
            - type: input
              schema: schema/properties/resources/properties/kubedbComMongoDB/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/securityContext/properties/runAsGroup
              label: Run as Group
            - type: input
              schema: schema/properties/resources/properties/kubedbComMongoDB/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/port
              label: Port
            - type: array-item-form
              label: Args
              schema: schema/properties/resources/properties/kubedbComMongoDB/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/args
              element:
                type: input
                label: name
                schema: schema/properties/resources/properties/kubedbComMongoDB/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/args/items
            - type: block-layout
              label: Metadata
              showLabels: false 
              elements: 
                - type: array-object-form
                  label: New Environment Variable
                  schema: schema/properties/items
                  elements:
                  - type: input
                    label: Name
                    schema: name
                    validation:
                      type: required
                  - type: radio
                    label: Value From
                    schema: temp/properties/valueFromType
                    init: 
                      type: func 
                      value: setValueFrom
                    options:
                    - text: Input
                      value: Input
                    - text: Secret
                      value: Secret
                    - text: ConfigMap
                      value: ConfigMap
                    # watcher:
                    #   func: onValueFromChange
                    #   paths:
                    #     - temp/properties/valueFromType
                  - type: input 
                    label: Value 
                    schema: value
                    # if:
                    #   name: isEqualToValueFromType|Input
                    #   type: function
                  - type: select
                    label: ConfigMap Name
                    schema: schema/items/properties/valueFrom/properties/configMapKeyRef/properties/name
                    # loader: resourceNames|core|v1|configmaps
                  - type: select
                    label: ConfigMap Key
                    schema: schema/items/properties/valueFrom/properties/configMapKeyRef/properties/key
                    # loader: getConfigMapKeys
                  - type: select
                    label: Secret Name
                    schema: schema/items/properties/valueFrom/properties/secretKeyRef/properties/name
                    # loader: getSecrets 
                  - type: select
                    label: Secret Key
                    schema: schema/items/properties/valueFrom/properties/secretKeyRef/properties/key
                    # loader: getSecretKeys 

        - type: input 
          label: 'label'
          schema: schema/properties/metadata/properties/release/properties/name
          # init: 
          #  type: func 
          #  value: setMetadata 
          # if:
          #   type: function
          #   name: returnFalse
      
      # - type: select
      #   label: Secret Key
      #   schema: select
      #   options:
  - type: single-step-form
    id: binding
    label: Gateway Binding
    elements:
    - type: switch
      label: Expose Database
      schema: temp/properties/binding
      fullwidth: true
      # init:
      #   type: func
      #   value: isBindingAlreadyOn
      # watcher:
      #   func: addOrRemoveBinding
      #   paths:
      #     - temp/properties/binding
