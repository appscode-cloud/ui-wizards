type: multi-step-form
step:
  - type: single-step-form
    id: storage-autoscaler
    loader: getDbDetails
    elements:
    - type: block-layout
      showLabels: false
      elements:
        - type: block-layout
          showLabels: true
          if:
            type: function
            name: isConsole
          elements:
            - type: input
              label: Name
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/metadata/properties/name
            - type: select
              label: SelectNamespace
              loader: getNamespaces
              hasGroup: isRancherManaged
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/metadata/properties/namespace
              watcher:
                func: onNamespaceChange
                paths:
                  - schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/metadata/properties/namespace
            - type: select
              label: Select Db
              loader: getDbs
              refresh: true
              required: true
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/databaseRef/properties/name
              watcher:
                func: initMetadata
                paths:
                  - schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/databaseRef/properties/name
        - type: radio
          label: Select Type
          hasDescription: true
          required: true
          isHorizontal: true
          schema: discriminator/properties/autoscalingType
          options:
            - text: Compute
              value: compute
              description: Scale your CPU Memory based on resource usage
            - text: Storage
              value: storage
              description: Expand your database size based on volume usage
          if:
            type: function
            name: isConsole
          watcher:
            func: initMetadata
            paths:
              - discriminator/properties/autoscalingType
        # Broker mode
        - type: block-layout
          label: Broker
          showLabels: true
          if:
            type: function
            name: dbTypeEqualsTo|topology
          elements:
            - type: select
              label: Trigger
              init:
                type: func
                value: setTrigger|autoscalingKubedbComKafkaAutoscaler/spec/storage/broker/trigger
              options:
                - text: 'On'
                  value: 'On'
                - text: 'Off'
                  value: 'Off'
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/broker/properties/trigger
            - type: select
              label: Expansion Mode
              options:
                - text: Online
                  value: Online
                - text: Offline
                  value: Offline
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/broker/properties/expansionMode
            - type: input
              label: UsageThreshold (%)
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/broker/properties/usageThreshold
            - type: array-object-form
              label: ScalingRules
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/broker/properties/scalingRules
              watcher:
                func: handleUnit|autoscalingKubedbComKafkaAutoscaler/spec/storage/broker/scalingRules|scalingRules
                paths:
                  - schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/broker/properties/scalingRules
              elements:
                - type: input
                  label: AppliesUpto (In Storage units)
                  schema: appliesUpto
                - type: input
                  label: Threshold (In %, Or In Storage Units)
                  schema: threshold
            - type: input
              label: UpperBound
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/broker/properties/upperBound
              watcher:
                func: handleUnit|autoscalingKubedbComKafkaAutoscaler/spec/storage/broker/upperBound
                paths:
                  - schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/broker/properties/upperBound
        # Controller mode
        - type: block-layout
          label: Controller
          showLabels: true
          if:
            type: function
            name: dbTypeEqualsTo|topology
          elements:
            - type: select
              label: Trigger
              init:
                type: func
                value: setTrigger|autoscalingKubedbComKafkaAutoscaler/spec/storage/controller/trigger
              options:
                - text: 'On'
                  value: 'On'
                - text: 'Off'
                  value: 'Off'
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/controller/properties/trigger
            - type: select
              label: Expansion Mode
              options:
                - text: Online
                  value: Online
                - text: Offline
                  value: Offline
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/controller/properties/expansionMode
            - type: input
              label: UsageThreshold (%)
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/controller/properties/usageThreshold
            - type: array-object-form
              label: ScalingRules
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/controller/properties/scalingRules
              watcher:
                func: handleUnit|autoscalingKubedbComKafkaAutoscaler/spec/storage/controller/scalingRules|scalingRules
                paths:
                  - schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/controller/properties/scalingRules
              elements:
                - type: input
                  label: AppliesUpto (In Storage units)
                  schema: appliesUpto
                - type: input
                  label: Threshold (In %, Or In Storage Units)
                  schema: threshold
            - type: input
              label: UpperBound
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/controller/properties/upperBound
              watcher:
                func: handleUnit|autoscalingKubedbComKafkaAutoscaler/spec/storage/controller/upperBound
                paths:
                  - schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/controller/properties/upperBound
        # Node mode
        - type: block-layout
          label: Node
          showLabels: true
          if:
            type: function
            name: dbTypeEqualsTo|combined
          elements:
            - type: select
              label: Trigger
              init:
                type: func
                value: setTrigger|autoscalingKubedbComKafkaAutoscaler/spec/storage/node/trigger
              options:
                - text: 'On'
                  value: 'On'
                - text: 'Off'
                  value: 'Off'
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/node/properties/trigger
            - type: select
              label: Expansion Mode
              options:
                - text: Online
                  value: Online
                - text: Offline
                  value: Offline
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/node/properties/expansionMode
            - type: input
              label: Usage Threshold (%)
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/node/properties/usageThreshold
            - type: array-object-form
              label: Scaling Rules
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/node/properties/scalingRules
              watcher:
                func: handleUnit|autoscalingKubedbComKafkaAutoscaler/spec/storage/node/scalingRules|scalingRules
                paths:
                  - schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/node/properties/scalingRules
              elements:
                - type: input
                  label: AppliesUpto (In Storage units)
                  schema: appliesUpto
                - type: input
                  label: Threshold (In %, Or In Storage Units)
                  schema: threshold
            - type: input
              label: UpperBound
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/node/properties/upperBound
              watcher:
                func: handleUnit|autoscalingKubedbComKafkaAutoscaler/spec/storage/node/upperBound
                paths:
                  - schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/storage/properties/node/properties/upperBound
        # Ops Request Options
        - type: block-layout
          label: Ops Request Options
          showLabels: true
          if:
            type: function
            name: showOpsRequestOptions
          elements:
            - type: select
              label: Timeout
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/opsRequestOptions/properties/timeout
              options:
                - text: 5 minutes
                  value: 5m0s
                - text: 10 minutes
                  value: 10m0s
                - text: 30 minutes
                  value: 30m0s
                - text: 1 hour
                  value: 1h0m
                - text: 2 hours
                  value: 2h0m
                - text: 5 hours
                  value: 5h0m
                - text: 10 hours
                  value: 10h0m
            - type: radio
              label: Apply
              init:
                type: func
                value: setApplyToIfReady
              options:
                - text: IfReady (OpsRequest will be applied if database is ready)
                  value: IfReady
                - text: Always (OpsRequest will always be applied)
                  value: Always
              schema: schema/properties/resources/properties/autoscalingKubedbComKafkaAutoscaler/properties/spec/properties/opsRequestOptions/properties/apply
