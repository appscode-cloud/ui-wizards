step:
- elements:
  - if:
      name: showScheduleBackup
      type: function
    init:
      type: func
      value: initScheduleBackupForEdit
    isHorizontal: true
    label: Schedule a Backup?
    options:
    - text: "Yes"
      value: "yes"
    - text: "No"
      value: "no"
    schema: temp/properties/scheduleBackup
    type: radio
    watcher:
      func: onScheduleBackupChange
      paths:
      - temp/properties/scheduleBackup
  - elements:
    - if:
        name: isBackupDataLoadedTrue
        type: function
      init:
        type: func
        value: setBackupType
      isHorizontal: true
      label: Select Backup Type
      loader: getTypes
      options:
      - description: Create, Delete or Modify BackupConfig
        text: BackupConfig
        value: BackupConfig
      - description: Enable/Disable BackupBlueprint
        text: BackupBlueprint
        value: BackupBlueprint
      schema: temp/properties/backupType
      type: radio
      watcher:
        func: onBackupTypeChange
        paths:
        - temp/properties/backupType
    - elements:
      - label: Select Context
        loader: getContext
        schema: temp/properties/backupConfigContext
        type: select
        validation:
          type: required
        watcher:
          func: onContextChange
          paths:
          - temp/properties/backupConfigContext
      - if:
          name: showConfigList
          type: function
        label: Select BackupConfig
        loader: getConfigList
        schema: temp/properties/config
        type: select
        validation:
          type: required
        watcher:
          func: onConfigChange
          paths:
          - temp/properties/config
      - if:
          name: showSchedule
          type: function
        label: Schedule
        loader:
          name: getDefaultSchedule|/resources/coreKubestashComBackupConfiguration/spec/sessions
          watchPaths:
          - temp/properties/config
        schema: temp/properties/schedule
        type: input
        validation:
          type: required
        watcher:
          func: onInputChangeSchedule|/resources/coreKubestashComBackupConfiguration/spec/sessions|schedule
          paths:
          - temp/properties/schedule
      - fullwidth: true
        if:
          name: showPause
          type: function
        init:
          type: func
          value: setPausedValue
        label: Paused
        schema: schema/properties/resources/properties/coreKubestashComBackupConfiguration/properties/spec/properties/paused
        type: switch
        watcher:
          func: setPausedValue
          paths:
          - temp/properties/config
      if:
        name: isBackupType|BackupConfig
        type: function
      label: Config
      type: block-layout
    - elements:
      - fullwidth: true
        init:
          type: func
          value: setBlueprintSwitch
        label: Enable Backup Blueprint
        schema: temp/properties/blueprintEnabled
        type: switch
        watcher:
          func: onBlueprintChange
          paths:
          - temp/properties/blueprintEnabled
      if:
        name: isBackupType|BackupBlueprint
        type: function
      label: Blueprint
      type: block-layout
    - elements:
      - fullwidth: true
        init:
          type: func
          value: setArchiverSwitch
        label: Enable Archiver
        schema: temp/properties/archiverEnabled
        type: switch
        watcher:
          func: onArchiverChange
          paths:
          - temp/properties/archiverEnabled
      if:
        name: isBackupType|Archiver
        type: function
      label: Archiver
      type: block-layout
    if:
      name: showBackupForm
      type: function
    label: Backup Form
    loader: initBackupData
    showLabels: false
    type: block-layout
  id: backupconfiguration
  schema: schema/
  type: single-step-form
- elements:
  - elements:
    - label: Name
      schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/metadata/properties/name
      type: input
    - if:
        name: isRancherManaged
        type: function
      label: Select Namespace
      loader: getNamespaces
      schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/metadata/properties/namespace
      type: select
      watcher:
        func: onNamespaceChange
        paths:
        - schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/metadata/properties/namespace
    - label: Select Db
      loader: getPostgresDbs
      refresh: true
      schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/databaseRef/properties/name
      type: select
      validation:
        type: required
      watcher:
        func: initMetadata
        paths:
        - schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/databaseRef/properties/name
    if:
      name: isConsole
      type: function
    type: block-layout
  - if:
      name: isConsole
      type: function
    label: Select Type
    options:
    - description: Scale your CPU Memory based on resource usage
      text: Compute
      value: compute
    - description: Expand your database size based on volume usage
      text: Storage
      value: storage
    schema: temp/properties/autoscalingType
    type: radio
    validation:
      type: required
    watcher:
      func: initMetadata
      paths:
      - temp/properties/autoscalingType
  - elements:
    - fullwidth: true
      init:
        type: func
        value: setTrigger|autoscalingKubedbComPostgresAutoscaler/spec/compute/postgres/trigger
      label: Trigger
      schema: temp/properties/compute/properties/postgres/properties/trigger
      type: switch
      watcher:
        func: onTriggerChange|compute/postgres
        paths:
        - temp/properties/compute/properties/postgres/properties/trigger
    - label: Pod lifetime threshold
      subtitle: Specifies the duration a pod can exist before using considered for
        scaling decisions, ensuring resource optimization and workload stability
      type: label-element
    - customClass: width-300
      label: Pod LifeTime Threshold (e.g., 10m 30s)
      schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/compute/properties/postgres/properties/podLifeTimeThreshold
      type: input
    - elements:
      - customClass: width-300
        label: ResourceDiff Percentage
        schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/compute/properties/postgres/properties/resourceDiffPercentage
        type: threshold-input
      - label: Resource Configuration
        subtitle: Define minimum and maximum allowed resources to ensure optimal database
          performance
        type: label-element
      - elements:
        - header: Minimum Resource Limit
          if:
            name: hasAnnotations
            type: function
          init:
            type: func
            value: setAllowedMachine|postgres|min
          label: Min Allowed Profile
          loader:
            name: getMachines|postgres|min
            watchPaths:
            - temp/properties/topologyMachines
            - temp/properties/allowedMachine-max
          schema: temp/properties/allowedMachine-min
          type: machine-compare
          watcher:
            func: onMachineChange|postgres
            paths:
            - temp/properties/allowedMachine-min
        - elements:
          - label: Cpu
            schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/compute/properties/postgres/properties/minAllowed/properties/cpu
            type: input-compare
          - label: Memory
            schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/compute/properties/postgres/properties/minAllowed/properties/memory
            type: input-compare
          fixedBlock: true
          if:
            name: hasNoAnnotations
            type: function
          label: Min Allowed
          showLabels: true
          type: block-layout
        - header: Maximum Resource Limit
          if:
            name: hasAnnotations
            type: function
          init:
            type: func
            value: setAllowedMachine|postgres|max
          label: Max Allowed Profile
          loader:
            name: getMachines|postgres|max
            watchPaths:
            - temp/properties/topologyMachines
            - temp/properties/allowedMachine-min
          schema: temp/properties/allowedMachine-max
          type: machine-compare
          watcher:
            func: onMachineChange|postgres
            paths:
            - temp/properties/allowedMachine-max
        - elements:
          - label: Cpu
            schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/compute/properties/postgres/properties/maxAllowed/properties/cpu
            type: input-compare
          - label: Memory
            schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/compute/properties/postgres/properties/maxAllowed/properties/memory
            type: input-compare
          fixedBlock: true
          if:
            name: hasNoAnnotations
            type: function
          label: Max Allowed
          showLabels: true
          type: block-layout
        showLabels: false
        type: block-layout
      - label: Controlled Resources
        loader: setControlledResources|postgres
        multiple: true
        schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/compute/properties/postgres/properties/controlledResources
        type: select
      - label: Container Controlled Values
        options:
        - text: Requests And Limits
          value: RequestsAndLimits
        - text: Requests Only
          value: RequestsOnly
        schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/compute/properties/postgres/properties/containerControlledValues
        type: select
      - elements:
        - label: Scaling Factor Percentage
          schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/compute/properties/postgres/properties/inMemoryStorage/properties/scalingFactorPercentage
          type: threshold-input
        - label: Usage Threshold Percentage
          schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/compute/properties/postgres/properties/inMemoryStorage/properties/usageThresholdPercentage
          type: threshold-input
        if:
          name: showStorageMemoryOption
          type: function
        label: In Memory Storage
        showLabels: true
        type: block-layout
      label: Postgres
      showLabels: true
      type: block-layout
    - elements:
      - label: Select NodeTopology
        loader: fetchNodeTopology
        schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/compute/properties/nodeTopology/properties/name
        type: select
      - if:
          name: isNodeTopologySelected
          type: function
        label: ScaleUp Diff Percentage
        schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/compute/properties/nodeTopology/properties/scaleUpDiffPercentage
        type: threshold-input
      - if:
          name: isNodeTopologySelected
          type: function
        label: ScaleDown Diff Percentage
        schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/compute/properties/nodeTopology/properties/scaleDownDiffPercentage
        type: threshold-input
      if:
        name: hasNoAnnotations
        type: function
      label: Node Topology
      showLabels: true
      type: block-layout
    - elements:
      - label: Timeout
        schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/opsRequestOptions/properties/timeout
        type: time-picker
      - init:
          type: func
          value: setApplyToIfReady
        label: Apply
        options:
        - text: IfReady (OpsRequest will be applied if database is ready)
          value: IfReady
        - text: Always (OpsRequest will always be applied)
          value: Always
        schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/opsRequestOptions/properties/apply
        type: radio
      if:
        name: showOpsRequestOptions
        type: function
      label: Ops Request Options
      showLabels: true
      type: block-layout
    loader: fetchTopologyMachines
    showLabels: false
    type: block-layout
  id: compute-autoscaler
  loader: getDbDetails
  type: single-step-form
- elements:
  - elements:
    - fullwidth: true
      init:
        type: func
        value: setTrigger|autoscalingKubedbComPostgresAutoscaler/spec/storage/postgres/trigger
      label: Trigger
      schema: temp/properties/storage/properties/postgres/properties/trigger
      type: switch
      watcher:
        func: onTriggerChange|storage/postgres
        paths:
        - temp/properties/storage/properties/postgres/properties/trigger
    - label: Expansion Mode (Online/Offline)
      subtitle: For Online Mode enables scaling without downtime by dynamically resizing
        storage while the database remains operational and Offline Mode performs storage
        scaling during scheduled downtime, ensuring consistency but requiring database
        restarts.
      type: label-element
    - description: Select how the storage expansion should be handled.
      label: Mode
      options:
      - text: Online
        value: Online
      - text: Offline
        value: Offline
      schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/storage/properties/postgres/properties/expansionMode
      type: select
    - elements:
      - label: UsageThreshold (%)
        schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/storage/properties/postgres/properties/usageThreshold
        subtitle: Set the threshold percentage of storage usage to trigger scaling.
        type: threshold-input
      - label: Scaling Rules
        loader: setValueFromDbDetails|resources/kubedbComPostgres/spec/storage/resources/requests/storage
        schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/storage/properties/postgres/properties/scalingRules
        type: scaling-rules
        watcher:
          func: handleUnit|autoscalingKubedbComPostgresAutoscaler/spec/storage/postgres/scalingRules|scalingRules
          paths:
          - schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/storage/properties/postgres/properties/scalingRules
      - label: UpperBound
        schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/storage/properties/postgres/properties/upperBound
        type: input
        watcher:
          func: handleUnit|autoscalingKubedbComPostgresAutoscaler/spec/storage/postgres/upperBound
          paths:
          - schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/storage/properties/postgres/properties/upperBound
      label: Postgres
      showLabels: true
      type: block-layout
    - elements:
      - label: Timeout
        schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/opsRequestOptions/properties/timeout
        type: time-picker
      - init:
          type: func
          value: setApplyToIfReady
        label: Apply
        options:
        - text: IfReady (OpsRequest will be applied if database is ready)
          value: IfReady
        - text: Always (OpsRequest will always be applied)
          value: Always
        schema: schema/properties/resources/properties/autoscalingKubedbComPostgresAutoscaler/properties/spec/properties/opsRequestOptions/properties/apply
        type: radio
      if:
        name: showOpsRequestOptions
        type: function
      label: OpsRequest Options
      showLabels: true
      type: block-layout
    showLabels: false
    type: block-layout
  id: storage-autoscaler
  type: single-step-form
- elements:
  - label: To update Exporter Resource section click on Create OpsRequest
    type: label-element
  - init:
      type: func
      value: getOpsRequestUrl|scale-vertically
    label: Create OpsRequest
    schema: temp/properties/opsRequestUrl
    type: anchor
  - fullwidth: true
    init:
      type: func
      value: isValueExistInModel|/resources/kubedbComPostgres/spec/monitor
    label: Enable Monitoring
    schema: temp/properties/enableMonitoring
    type: switch
    watcher:
      func: onEnableMonitoringChange
      paths:
      - temp/properties/enableMonitoring
  - elements:
    - init:
        type: static
        value: prometheus.io/operator
      isHorizontal: true
      label: Select a Monitoring Method
      options:
      - description: Inject metric exporter sidecar and creates a ServiceMonitor
        text: Prometheus Operator
        value: prometheus.io/operator
      - description: Injects the metric exporter sidecar and let you customize ServiceMonitor
        text: Custom ServiceMonitor
        value: prometheus.io
      - description: Inject metric exporter sidecar and add Prometheus annotations
          to the stats Service
        text: Custom Scrapper
        value: prometheus.io/builtin
      schema: schema/properties/resources/properties/kubedbComPostgres/properties/spec/properties/monitor/properties/agent
      type: radio
      watcher:
        func: onAgentChange
        paths:
        - schema/properties/resources/properties/kubedbComPostgres/properties/spec/properties/monitor/properties/agent
    - elements:
      - label: Scrapping Interval
        schema: schema/properties/resources/properties/kubedbComPostgres/properties/spec/properties/monitor/properties/prometheus/properties/serviceMonitor/properties/interval
        type: input
      if:
        name: isEqualToModelPathValue|prometheus.io/operator|/resources/kubedbComPostgres/spec/monitor/agent
        type: function
      label: ServiceMonitor Configuration
      showLabels: true
      type: block-layout
    - elements:
      - buttonClass: is-light is-outlined
        elements:
        - fullwidth: true
          label: Honor labels
          schema: honorLabels
          type: switch
        - label: Interval
          schema: interval
          type: input
          validation:
            type: required
        - label: Path
          schema: path
          type: input
          validation:
            type: required
        - label: Port
          schema: port
          type: input
          validation:
            type: required
        label: Endpoints
        schema: schema/properties/resources/properties/monitoringCoreosComServiceMonitor/properties/spec/properties/endpoints
        type: array-object-form
      - if:
          name: returnFalse
          type: function
        label: Match Namespaces
        loader: getResources|core|v1|namespaces
        multiple: true
        schema: schema/properties/resources/properties/monitoringCoreosComServiceMonitor/properties/spec/properties/namespaceSelector/properties/matchNames
        type: select
      - elements:
        - label: Labels
          schema: schema/properties/resources/properties/monitoringCoreosComServiceMonitor/properties/spec/properties/selector/properties/matchLabels
          type: object-item
        if:
          name: returnFalse
          type: function
        showLabels: false
        type: block-layout
      if:
        name: isEqualToModelPathValue|prometheus.io|/resources/kubedbComPostgres/spec/monitor/agent
        type: function
      label: Service Monitor
      showLabels: true
      type: block-layout
    - buttonClass: is-light is-outlined
      if:
        name: isEqualToModelPathValue|prometheus.io|/resources/kubedbComPostgres/spec/monitor/agent
        type: function
      label: Labels
      schema: schema/properties/resources/properties/monitoringCoreosComServiceMonitor/properties/metadata/properties/labels
      type: object-item
    - label: Exporter Configuration
      schema: ""
      type: label-element
    - fullwidth: true
      init:
        type: static
        value: true
      label: Customize Exporter Sidecar
      schema: temp/properties/customizeExporter
      type: switch
      watcher:
        func: onCustomizeExporterChange
        paths:
        - temp/properties/customizeExporter
    - elements:
      - if:
          name: returnFalse
          type: function
        label: Resources
        schema: schema/properties/resources/properties/kubedbComPostgres/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/resources
        type: machine-compare
      - label: Security Context
        schema: ""
        type: label-element
      - label: Run as User
        schema: schema/properties/resources/properties/kubedbComPostgres/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/securityContext/properties/runAsUser
        type: input
      - label: Run as Group
        schema: schema/properties/resources/properties/kubedbComPostgres/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/securityContext/properties/runAsGroup
        type: input
      - label: Port
        schema: schema/properties/resources/properties/kubedbComPostgres/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/port
        type: input
      - buttonClass: is-light is-outlined
        element:
          label: Args
          type: input
        init:
          type: static
          value:
          - --compatible-mode
        label: Args
        schema: schema/properties/resources/properties/kubedbComPostgres/properties/spec/properties/monitor/properties/prometheus/properties/exporter/properties/args
        type: array-item-form
      - elements:
        - buttonClass: is-light is-outlined
          elements:
          - label: Name
            schema: name
            type: input
            validation:
              type: required
          - init:
              type: func
              value: setValueFrom
            label: Value From
            options:
            - text: Input
              value: input
            - text: Secret
              value: secret
            - text: ConfigMap
              value: configMap
            schema: temp/properties/valueFromType
            type: radio
            validation:
              type: required
            watcher:
              func: onValueFromChange
              paths:
              - temp/properties/valueFromType
          - if:
              name: isEqualToTemp|input
              type: function
            label: Value
            schema: value
            type: input
            validation:
              type: required
          - if:
              name: isEqualToTemp|configMap
              type: function
            label: ConfigMap Name
            loader:
              name: resourceNames|core|v1|configmaps
              watchPaths:
              - schema/metadata/release/namespace
            schema: valueFrom/properties/configMapKeyRef/properties/name
            type: select
            validation:
              type: required
          - if:
              name: isEqualToTemp|configMap
              type: function
            label: ConfigMap Key
            loader:
              name: getConfigMapKeys
              watchPaths:
              - schema/resources/kubedbComPostgres/spec/monitor/prometheus/exporter/env/dynamicIndex/valueFrom/configMapKeyRef/name
              - schema/metadata/release/namespace
            schema: valueFrom/properties/configMapKeyRef/properties/key
            type: select
          - if:
              name: isEqualToTemp|secret
              type: function
            label: Secret Name
            loader:
              name: getSecrets
              watchPaths:
              - schema/metadata/release/namespace
            schema: valueFrom/properties/secretKeyRef/properties/name
            type: select
            validation:
              type: required
          - if:
              name: isEqualToTemp|secret
              type: function
            label: Secret Key
            loader:
              name: getSecretKeys
              watchPaths:
              - schema/resources/kubedbComPostgres/spec/monitor/prometheus/exporter/env/dynamicIndex/valueFrom/secretKeyRef/name
              - schema/metadata/release/namespace
            schema: valueFrom/properties/secretKeyRef/properties/key
            type: select
          init:
            type: func
            value: initEnvArray
          label: Environment Variables
          schema: temp/properties/env
          type: array-object-form
          watcher:
            func: onEnvArrayChange
            paths:
            - temp/properties/env
        label: Metadata
        showLabels: false
        type: block-layout
      if:
        name: showCustomizeExporterSection
        type: function
      label: Customer Exporter Section
      showLabels: false
      type: block-layout
    if:
      name: showMonitoringSection
      type: function
    type: block-layout
  id: monitoring
  loader: initMonitoring
  type: single-step-form
- elements:
  - fullwidth: true
    init:
      type: func
      value: isBindingAlreadyOn
    label: Expose Database
    schema: temp/properties/binding
    type: switch
    watcher:
      func: addOrRemoveBinding
      paths:
      - temp/properties/binding
  id: binding
  type: single-step-form
type: multi-step-form
