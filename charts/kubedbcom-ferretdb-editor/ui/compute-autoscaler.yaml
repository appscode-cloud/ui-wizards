- type: single-step-form
  id: compute-autoscaler
  loader: getDbDetails
  elements:
    - type: block-layout
      if:
       type: function
       name: isConsole
      elements:
        - type: input
          label: Name
          schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/metadata/properties/name
        - type: select
          label: Select Namespace
          loader: getNamespaces
          if:
            type: function
            name: isRancherManaged
          schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/metadata/properties/namespace
          watcher:
            func: onNamespaceChange
            paths:
              - schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/metadata/properties/namespace
        - type: select
          label: Select Db
          loader: getDbs
          validation:
            type: required
          refresh: true
          schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/databaseRef/properties/name
          watcher:
            func: initMetadata
            paths:
              - schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/databaseRef/properties/name

    - type: radio
      if:
        type: function
        name: isConsole
      label: Select Type
      validation:
        type: required
      schema: temp/properties/autoscalingType
      watcher:
        func: initMetadata
        paths:
          - temp/properties/autoscalingType
      options:
        - text: Compute
          value: compute
          description: Scale your CPU Memory based on resource usage
        - text: Storage
          value: storage
          description: Expand your database size based on volume usage

    - type: block-layout
      showLabels: false
      loader: fetchTopologyMachines
      elements:
        # primary
        - type: block-layout
          label: Primary
          showLabels: true
          # schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/primary
          elements:
            - type: select
              label: Trigger
              init:
                type: func
                value: setTrigger|autoscalingKubedbComFerretDBAutoscaler/spec/compute/primary/trigger
              options:
                - text: 'On'
                  value: 'On'
                - text: 'Off'
                  value: 'Off'
              schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/primary/properties/trigger
            - type: input
              label: Pod LifeTime Threshold
              schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/primary/properties/podLifeTimeThreshold
            - type: input
              label: Resource Diff Percentage
              schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/primary/properties/resourceDiffPercentage
            - type: block-layout
              showLabels: false
              elements:
                - type: select
                  label: Min Allowed Profile
                  disableUnselect: true
                  schema: temp/properties/allowedMachine-primary-min
                  if:
                    type: function
                    name: hasAnnotations
                  init:
                    type: func
                    value: setAllowedMachine|primary|min
                  loader:
                    name: getMachines|primary|min
                    watchPaths:
                      - temp/properties/topologyMachines
                      - temp/properties/allowedMachine-primary-max
                  watcher:
                    func: onMachineChange|primary
                    paths:
                      - temp/properties/allowedMachine-primary-min
                - type: block-layout
                  label: Min Allowed
                  if:
                    type: function
                    name: hasNoAnnotations
                  showLabels: true
                  elements:
                    - type: input
                      label: Cpu
                      schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/primary/properties/minAllowed/properties/cpu
                    - type: input
                      label: Memory
                      schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/primary/properties/minAllowed/properties/memory
                - type: select
                  label: Max Allowed Profile
                  disableUnselect: true
                  schema: temp/properties/allowedMachine-primary-max
                  if:
                    type: function
                    name: hasAnnotations
                  init:
                    type: func
                    value: setAllowedMachine|primary|max
                  loader:
                    name: getMachines|primary|max
                    watchPaths:
                      - temp/properties/topologyMachines
                      - temp/properties/allowedMachine-primary-min
                  watcher:
                    func: onMachineChange|primary
                    paths:
                      - temp/properties/allowedMachine-primary-max
                - type: block-layout
                  label: Max Allowed
                  if:
                    type: function
                    name: hasNoAnnotations
                  showLabels: true
                  elements:
                    - type: input
                      label: Cpu
                      schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/primary/properties/maxAllowed/properties/cpu
                    - type: input
                      label: Memory
                      schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/primary/properties/maxAllowed/properties/memory
            - type: select
              label: Controlled Resources
              loader: setControlledResources|primary
              multiple: true
              schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/primary/properties/controlledResources

        # secondary
        - type: block-layout
          label: Secondary
          if:
            type: function
            name: ferretTypeEqualsTo|secondary
          showLabels: true
          # schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/secondary
          elements:
            - type: select
              label: Trigger
              init:
                type: func
                value: setTrigger|autoscalingKubedbComFerretDBAutoscaler/spec/compute/secondary/trigger
              options:
                - text: 'On'
                  value: 'On'
                - text: 'Off'
                  value: 'Off'
              schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/secondary/properties/trigger
            - type: input
              label: Pod LifeTime Threshold
              schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/secondary/properties/podLifeTimeThreshold
            - type: input
              label: Resource Diff Percentage
              schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/secondary/properties/resourceDiffPercentage
            - type: block-layout
              showLabels: false
              elements:
                - type: select
                  label: Min Allowed Profile
                  disableUnselect: true
                  schema: temp/properties/allowedMachine-secondary-min
                  if:
                    type: function
                    name: hasAnnotations
                  init:
                    type: func
                    value: setAllowedMachine|secondary|min
                  loader:
                    name: getMachines|secondary|min
                    watchPaths:
                      - temp/properties/topologyMachines
                      - temp/properties/allowedMachine-secondary-max
                  watcher:
                    func: onMachineChange|secondary
                    paths:
                      - temp/properties/allowedMachine-secondary-min
                - type: block-layout
                  label: Min Allowed
                  if:
                    type: function
                    name: hasNoAnnotations
                  showLabels: true
                  elements:
                    - type: input
                      label: Cpu
                      schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/secondary/properties/minAllowed/properties/cpu
                    - type: input
                      label: Memory
                      schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/secondary/properties/minAllowed/properties/memory
                - type: select
                  label: Max Allowed Profile
                  disableUnselect: true
                  schema: temp/properties/allowedMachine-secondary-max
                  if:
                    type: function
                    name: hasAnnotations
                  init:
                    type: func
                    value: setAllowedMachine|secondary|max
                  loader:
                    name: getMachines|secondary|max
                    watchPaths:
                      - temp/properties/topologyMachines
                      - temp/properties/allowedMachine-secondary-min
                  watcher:
                    func: onMachineChange|secondary
                    paths:
                      - temp/properties/allowedMachine-secondary-max
                - type: block-layout
                  label: Max Allowed
                  if:
                    type: function
                    name: hasNoAnnotations
                  showLabels: true
                  elements:
                    - type: input
                      label: Cpu
                      schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/secondary/properties/maxAllowed/properties/cpu
                    - type: input
                      label: Memory
                      schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/secondary/properties/maxAllowed/properties/memory
            - type: select
              label: Controlled Resources
              loader: setControlledResources|secondary
              multiple: true
              schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/secondary/properties/controlledResources

        - type: block-layout
          label: Node Topology
          if:
            type: function
            name: hasNoAnnotations
          showLabels: true
          # schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/nodeTopology
          elements:
            - type: select
              label: Select NodeTopology
              loader: fetchNodeTopology
              schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/nodeTopology/properties/name
            - type: input
              label: ScaleUp Diff Percentage
              if:
                type: function
                name: isNodeTopologySelected
              schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/nodeTopology/properties/scaleUpDiffPercentage
            - type: input
              label: ScaleDown Diff Percentage
              if:
                type: function
                name: isNodeTopologySelected
              schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/compute/properties/nodeTopology/properties/scaleDownDiffPercentage

        - type: block-layout
          label: Ops Request Options
          showLabels: true
          if:
            type: function
            name: showOpsRequestOptions
          # schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/opsRequestOptions
          elements:
            - type: select
              label: Timeout
              schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/opsRequestOptions/properties/timeout
              options:
              - text: 5 minutes
                value: 5m0s
              - text: 10 minutes
                value: 10m0s
              - text: 30 minutes
                value: 30m0s
              - text: 1 hour
                value: 1h0m
              - text: 2 hours
                value: 2h0m
              - text: 5 hours
                value: 5h0m
              - text: 10 hours
                value: 10h0m
            - type: radio
              label: Apply
              init:
                type: func
                value: setApplyToIfReady
              options:
                - text: IfReady (OpsRequest will be applied if database is ready)
                  value: IfReady
                - text: Always (OpsRequest will always be applied)
                  value: Always
              schema: schema/properties/resources/properties/autoscalingKubedbComFerretDBAutoscaler/properties/spec/properties/opsRequestOptions/properties/apply
