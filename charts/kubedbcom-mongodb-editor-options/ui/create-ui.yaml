step:
- type: single-step-form
  loader: initBundle
  elements:
  - type: label-element
    label: ''
    subtitle: Select the MongoDB version you want to deploy on Kubernetes. The chosen version determines the MongoDB engine features, compatibility, and runtime behavior of your database cluster.
  - disableUnselect: true
    loader: getAdminOptions|databases/MongoDB/versions
    if:
      type: function
      name: isToggleOn|databases/MongoDB/versions
    label: Database Version
    schema: schema/properties/spec/properties/admin/properties/databases/properties/MongoDB/properties/versions/properties/default
    type: select
  - init:
     type: func
     value: getDefault|databases/MongoDB/mode
    loader: getAdminOptions|databases/MongoDB/mode
    isHorizontal: true
    if:
      type: function
      name: isToggleOn|databases/MongoDB/mode
    label:  Database Mode
    watcher: 
      func: clearArbiterHidden
      paths:
        - schema/properties/spec/properties/mode
    schema: schema/properties/spec/properties/mode
    type: radio
  - elements:
    - type: horizontal-layout
      showLabels: true
      elements:
        - label: Replicaset Name
          schema: schema/properties/spec/properties/replicaSet/properties/name
          type: input
        - label: Replicaset Number
          watcher:
            func: updateSuffix
            paths:
              - schema/properties/spec/properties/replicaSet/properties/replicas
          schema: schema/properties/spec/properties/replicaSet/properties/replicas
          type: input
    - if:
       type: function
       name: isTlsOn
      label: Do you want to access mongodb+srv style DNS?
      watcher: 
        func: onHorizonsChange
        paths:
          - discriminator/enableHorizons
      schema: discriminator/enableHorizons
      type: switch
    - if: 
        type: function
        name: isHorizonsOn
      label: Horizons count should be equal to Replica Number.
      type: alert
    - type: array-item-form
      element:
        label: Add a new horizon dns for pod
        type: input
      if:
        type: function
        name: isHorizonsOn
      label: Horizons
      watcher:
        func: updateSuffix
        paths:
          - schema/properties/spec/properties/replicaSet/properties/horizons
      schema: schema/properties/spec/properties/replicaSet/properties/horizons
      validation: 
        type: custom
        name: isHorizonsValid
    if:
      type: function
      name: isEqualToModelPathValue|Replicaset|/spec/mode
    type: block-layout
  - elements:
    - elements:
      - type: label-element
        label: ''
        subtitle: Configure Shard Nodes to define how MongoDB data is partitioned, replicated, and resourced across your Kubernetes cluster.
      - type: horizontal-layout
        showLabels: true
        elements:
        - label: Shards
          schema: schema/properties/spec/properties/shardTopology/properties/shard/properties/shards
          type: input
        - label: Replicaset Number
          schema: schema/properties/spec/properties/shardTopology/properties/shard/properties/replicas
          type: input
        - label: Storage size
          schema: schema/properties/spec/properties/shardTopology/properties/shard/properties/persistence/properties/size
          type: input
      - elements:
        - type : horizontal-layout
          showLabels: true
          elements:
          - init: 
              type: func
              value: setMachineToCustom|shardTopology/shard
            loader: getMachineListForOptions
            label: Machine
            schema: schema/properties/spec/properties/shardTopology/properties/shard/properties/podResources/properties/machine
            type: select
          - init: 
              type: func
              value: setLimits|cpu|shardTopology/shard
            if: 
              type: function
              name: isMachineCustom|shardTopology/shard
            label: cpu
            watcher:
              func: setRequests|cpu|shardTopology/shard
              paths:
                - schema/properties/spec/properties/shardTopology/properties/shard/properties/podResources/properties/resources/properties/requests/properties/cpu
                - schema/properties/spec/properties/shardTopology/properties/shard/properties/podResources/properties/machine
            schema: schema/properties/spec/properties/shardTopology/properties/shard/properties/podResources/properties/resources/properties/requests/properties/cpu
            type: input
          - init: 
              type: func
              value: setLimits|memory|shardTopology/shard
            if: 
              type: function
              name: isMachineCustom|shardTopology/shard
            label: memory
            watcher:
              func: setRequests|memory|shardTopology/shard
              paths:
                - schema/properties/spec/properties/shardTopology/properties/shard/properties/podResources/properties/resources/properties/requests/properties/memory
                - schema/properties/spec/properties/shardTopology/properties/shard/properties/podResources/properties/machine
            schema: schema/properties/spec/properties/shardTopology/properties/shard/properties/podResources/properties/resources/properties/requests/properties/memory
            type: input
        type: block-layout
      label: Shard Nodes 
      showLabels: true
      type: block-layout
    - elements:
      - type: label-element
        label: ''
        subtitle: Config Servers store metadata about the sharded cluster, including chunk distribution and shard configuration.They must run as a replica set to ensure cluster consistency and availability.
      - type: horizontal-layout
        showLabels: true
        elements:
        - label: Replicaset Number
          schema: schema/properties/spec/properties/shardTopology/properties/configServer/properties/replicas
          type: input
        - label: Storage size
          schema: schema/properties/spec/properties/shardTopology/properties/configServer/properties/persistence/properties/size
          type: input
      - elements:
        - type : horizontal-layout
          showLabels: true
          elements:
            - init: 
                type: func
                value: setMachineToCustom|shardTopology/configServer
              loader: getMachineListForOptions
              label: Machine
              schema: schema/properties/spec/properties/shardTopology/properties/configServer/properties/podResources/properties/machine
              type: select
            - init: 
                type: func
                value: setLimits|cpu|shardTopology/configServer
              if: 
                type: function
                name:  isMachineCustom|shardTopology/configServer
              label: cpu
              watcher: 
                func: setRequests|cpu|shardTopology/configServer
                paths:
                  - schema/properties/spec/properties/shardTopology/properties/configServer/properties/podResources/properties/resources/properties/requests/properties/cpu
                  - schema/properties/spec/properties/shardTopology/properties/configServer/properties/podResources/properties/machine
              schema: schema/properties/spec/properties/shardTopology/properties/configServer/properties/podResources/properties/resources/properties/requests/properties/cpu
              type: input
            - init: 
                type: func
                value: setLimits|memory|shardTopology/configServer
              if: 
                type: function
                name: isMachineCustom|shardTopology/configServer
              label: memory
              watcher:
                func: setRequests|memory|shardTopology/configServer
                paths:
                  - schema/properties/spec/properties/shardTopology/properties/configServer/properties/podResources/properties/resources/properties/requests/properties/memory
                  - schema/properties/spec/properties/shardTopology/properties/configServer/properties/podResources/properties/machine
              schema: schema/properties/spec/properties/shardTopology/properties/configServer/properties/podResources/properties/resources/properties/requests/properties/memory
              type: input
        type: block-layout
      label: Config Server
      showLabels: true
      type: block-layout
    - elements:
      - type: label-element
        label: ''
        subtitle: Mongos acts as the query router for the sharded cluster, directing client requests to the appropriate shards based on metadata from Config Servers.
      - customClass: mt-10
        label: Replicaset number
        schema: schema/properties/spec/properties/shardTopology/properties/mongos/properties/replicas
        type: input
      - type: horizontal-layout
        showLabels: true 
        elements:
        - init:
            type: func
            value: setMachineToCustom|shardTopology/mongos
          loader: getMachineListForOptions
          label: Machine
          schema: schema/properties/spec/properties/shardTopology/properties/mongos/properties/podResources/properties/machine
          type: select
        - init:
            type: func
            value: setLimits|cpu|shardTopology/mongos
          if: 
            type: function
            name: isMachineCustom|shardTopology/mongos
          label: Cpu
          watcher:
            func: setRequests|cpu|shardTopology/mongos
            paths:
              -  schema/properties/spec/properties/shardTopology/properties/mongos/properties/podResources/properties/resources/properties/requests/properties/cpu
              -  schema/properties/spec/properties/shardTopology/properties/mongos/properties/podResources/properties/machine
          schema: schema/properties/spec/properties/shardTopology/properties/mongos/properties/podResources/properties/resources/properties/requests/properties/cpu
          type: input
        - init:
            type: func
            value: setLimits|memory|shardTopology/mongos
          if: 
            type: function
            name: isMachineCustom|shardTopology/mongos
          label: Memory
          watcher:
            func: setRequests|memory|shardTopology/mongos
            paths:
              -  schema/properties/spec/properties/shardTopology/properties/mongos/properties/podResources/properties/resources/properties/requests/properties/memory
              -  schema/properties/spec/properties/shardTopology/properties/mongos/properties/podResources/properties/machine
          schema: schema/properties/spec/properties/shardTopology/properties/mongos/properties/podResources/properties/resources/properties/requests/properties/memory
          type: input
      label: Mongos
      showLabels: true
      type: block-layout
    if: 
      type: function
      name: isEqualToModelPathValue|Sharded|/spec/mode
    type: block-layout
  - elements:
    - type: label-element
      label: ''
      subtitle: Select a machine profile to allocate CPU and memory resources for your database. Choose 'custom' to manually specify resource requirements or select a predefined profile.
    - type: horizontal-layout
      showLabels: true
      elements:
        - init:
            type: func
            value: setMachineToCustom
          loader: getMachineListForOptions
          label: Machine 
          schema: schema/properties/spec/properties/podResources/properties/machine
          type: select
        - init:
            type: func
            value: setLimits|cpu
          disable: isMachineNotCustom|schema/properties/spec/properties/podResources/properties/machine
          if:
            type: function
            name: isMachineCustom
          label: cpu
          watcher:
            func: setRequests|cpu
            paths:
              -  schema/properties/spec/properties/podResources/properties/resources/properties/requests/properties/cpu
              -  schema/properties/spec/properties/podResources/properties/machine
          schema: schema/properties/spec/properties/podResources/properties/resources/properties/requests/properties/cpu
          type: input
        - init:
            type: func
            value: setLimits|memory
          if:
            type: function
            name: isMachineCustom
          label: Memory
          watcher:
            func: setRequests|memory
            paths:
              - schema/properties/spec/properties/podResources/properties/resources/properties/requests/properties/memory
              - schema/properties/spec/properties/podResources/properties/machine 
          schema: schema/properties/spec/properties/podResources/properties/resources/properties/requests/properties/memory
          type: input
    if:
      type: function
      name: notEqualToDatabaseMode|Sharded
    label: Machine profile
    showLabels: true
    type: block-layout
  - type: horizontal-layout
    showLabels: true
    elements:
      - loader: getAdminOptions|storageClasses
        if:
          type: function
          name: isToggleOn|storageClasses
        label: Storage select
        schema: schema/properties/spec/properties/admin/properties/storageClasses/properties/default
        type: select
      - if:
          type: function
          name: showStorageSizeField
        label: Storage size
        schema: schema/properties/spec/properties/persistence/properties/size
        type: input
  - description: Configure Credentials, Deployment Mode etc.
    elements:
    - elements:
      - type: label-element
        label: ''
        subtitle: Add custom labels and annotations to your database resources for organization, monitoring, and integration with other Kubernetes tools and services.
      - type: object-item
        label: Labels
        buttonClass: is-light is-outlined
        schema: schema/properties/spec/properties/labels
      - type: object-item
        label: Annotations
        buttonClass: is-light is-outlined
        schema: schema/properties/spec/properties/annotations
      label: Labels & Annotations
      showLabels: true
      hideBlock: true
      type: block-layout
    - init: 
        type: func
        value: getDefault|deletionPolicy
      customClass: mt-20
      if:
        type: function
        name: isToggleOn|deletionPolicy
      label: Deletion Policy
      watcher:
        func: setStorageClass
        paths:
          - schema/properties/spec/properties/deletionPolicy
      options:
      - description: options.deletionPolicy.delete.description
        text: Delete
        value: Delete
      - description: options.deletionPolicy.halt.description
        text: Halt
        value: Halt
      - description: options.deletionPolicy.wipeOut.description
        text: WipeOut
        value: WipeOut
      - description: options.deletionPolicy.doNotTerminate.description
        text: DoNotTerminate
        value: DoNotTerminate
      schema: schema/properties/spec/properties/deletionPolicy
      type: select
    - if: 
        type: function
        name: getDefaultValue|spec/admin/authCredential/customize
      label: Provide Authentication Credentials?
      watcher:
        func: onAuthChange
        paths:
          - temp/createAuthSecret
      schema: temp/createAuthSecret
      type: switch
    - if: 
        type: function
        name:  showReferSecretSwitch
      label: Refer existing Secret?
      watcher:
        func: onReferSecretChange
        paths:
          - temp/referSecret
      schema: temp/referSecret
      type: switch
    - loader: getReferSecrets
      if: 
        type: function
        name:  showSecretDropdown
      label: Secret
      schema: schema/properties/spec/properties/authSecret/properties/name
      type: select
    - if:
        type: function
        name: showReferSecret
      label: Password
      schema: schema/properties/spec/properties/authSecret/properties/password
      type: input
    - if:
        type: function
        name: getDefaultValue|spec/admin/customConfiguration
      label: Configure Database?
      watcher:
        func: clearConfiguration
        paths:
          - temp/configDatabase
      schema: temp/configDatabase
      type: switch
    - if:
        type: function
        name: isConfigDatabaseOn
      label: Configuration
      # hasCopy: true
      schema: schema/properties/spec/properties/configuration
      type: textarea
    - if:
        type: function
        name: notEqualToDatabaseMode|Standalone
      label: Enable Arbiter?
      schema: schema/properties/spec/properties/arbiter/properties/enabled
      type: switch
    - elements:
      - type: label-element
        label: ''
        subtitle: Configure resource allocation for arbiter nodes, which participate in elections but do not store data. Arbiters help maintain quorum in replica sets with minimal resource overhead.
      - type: horizontal-layout
        showLabels: true
        elements:
        - init:
            type: func
            value: setMachineToCustom|arbiter
          loader: getMachineListForOptions
          label: Machine
          schema: schema/properties/spec/properties/arbiter/properties/podResources/properties/machine
          type: select
        - init:
            type: func
            value: setLimits|cpu|arbiter
          if:
            type: function
            name: isMachineCustom|arbiter
          label: cpu
          watcher:
            func: setRequests|cpu|arbiter
            paths:
              - schema/properties/spec/properties/arbiter/properties/podResources/properties/resources/properties/requests/properties/cpu
              - schema/properties/spec/properties/arbiter/properties/podResources/properties/machine
          schema: schema/properties/spec/properties/arbiter/properties/podResources/properties/resources/properties/requests/properties/cpu
          type: input
        - init:
            type: func
            value: setLimits|memory|arbiter
          if:
            type: function
            name: isMachineCustom|arbiter
          label: memory
          watcher:
            func: setRequests|memory|arbiter
            paths:
              - schema/properties/spec/properties/arbiter/properties/podResources/properties/resources/properties/requests/properties/memory
              - schema/properties/spec/properties/arbiter/properties/podResources/properties/machine
          schema: schema/properties/spec/properties/arbiter/properties/podResources/properties/resources/properties/requests/properties/memory
          type: input
      if:
        type: function
        name: showArbiter
      label: Arbiter
      showLabels: true
      type: block-layout
    - if:
        type: function
        name: notEqualToDatabaseMode|Standalone
      label: Enable hidden?
      schema: schema/properties/spec/properties/hidden/properties/enabled
      type: switch
    - elements:
      - type: label-element
        label: ''
        subtitle: Configure hidden members that replicate data invisibly to clients. Define replicas, storage, and resource allocation for dedicated backup, analytics, or reporting operations.
      - type: horizontal-layout
        showLabels: true
        elements:
        - label: Replicas
          schema: schema/properties/spec/properties/hidden/properties/replicas
          type: input
        - label: Persistence Size
          schema: schema/properties/spec/properties/hidden/properties/persistence/properties/size
          type: input
      - type: horizontal-layout
        showLabels: true
        elements:
        - init:
            type: func
            value: setMachineToCustom|hidden
          loader: getMachineListForOptions
          label: Machine
          schema: schema/properties/spec/properties/hidden/properties/podResources/properties/machine
          type: select
        - init:
            type: func
            value: setLimits|cpu|hidden
          if:
            type: function
            name: isMachineCustom|hidden
          label: cpu
          watcher:
            func: setRequests|cpu|hidden
            paths:
              - schema/properties/spec/properties/hidden/properties/podResources/properties/resources/properties/requests/properties/cpu
              - schema/properties/spec/properties/hidden/properties/podResources/properties/machine
          schema: schema/properties/spec/properties/hidden/properties/podResources/properties/resources/properties/requests/properties/cpu
          type: input
        - init:
            type: func
            value: setLimits|memory|hidden
          if: 
            type: function
            name: isMachineCustom|hidden
          label: memory
          watcher:
            func: setRequests|memory|hidden
            paths:
              - schema/properties/spec/properties/hidden/properties/podResources/properties/resources/properties/requests/properties/memory
              - schema/properties/spec/properties/hidden/properties/podResources/properties/machine
          schema: schema/properties/spec/properties/hidden/properties/podResources/properties/resources/properties/requests/properties/memory
          type: input
      if:
        type: function
        name: showHidden
      label: Hidden
      showLabels: true
      type: block-layout
    - init:
        type: func
        value: getDefault|pointInTimeRecovery
      if:
        type: function
        name: isToggleOn|pointInTimeRecovery
      label: Point in-time Recovery?
      schema: temp/recovery
      type: switch
    - elements:
      - type: label-element
        label: ''
        subtitle: Restore your database to a specific point in time by selecting the source backup namespace, database name, and the exact timestamp for recovery.
      - type: horizontal-layout
        showLabels: true
        elements:
          - label: Namespace
            watcher:
              func: setPointInTimeRecovery
              paths:
                - temp/refNamespace
            forceRequired: true
            validation:
              type: required
            schema: temp/refNamespace
            type: input
          - label: Name
            watcher:
              func: setPointInTimeRecovery
              paths:
                - temp/refDBName
            validation:
              type: required
            schema: temp/refDBName
            type: input
      - label: Recovery Timestamp
        schema: schema/properties/spec/properties/init/properties/archiver/properties/recoveryTimestamp
        type: date-time
        watcher:
          func: onTimestampChange
          paths:
            - schema/properties/spec/properties/init/properties/archiver/properties/recoveryTimestamp
      if:
        type: function
        name: showRecovery
      label: Point in-time Recovery
      showLabels: true
      type: block-layout
    - if:
        type: function
        name: isToggleOn|deployment
      label: Deployment
      options:
      - description: shared
        text: Shared
        value: Shared
      - description: Dedicated
        text: Dedicated
        value: Dedicated
      schema: schema/properties/spec/properties/admin/properties/deployment/properties/default
      type: radio
    - if:
        type: function
        name: isToggleOn|clusterTier
      isHorizontal: true
      label: ClusterTier
      options:
      - text: General Purpose
        value: GeneralPurpose
      - text: Memory Optimized
        value: MemoryOptimized
      - text: CPU Optimized
        value: CPUOptimized
      schema: schema/properties/spec/properties/admin/properties/clusterTier/properties/default
      type: radio
    - disableUnselect: true
      loader: getAdminOptions|clusterTier/placement
      if:
        type: function
        name: isToggleOn|clusterTier/placement
      label: labels.placement
      schema: schema/properties/spec/properties/admin/properties/clusterTier/properties/placement/properties/default
      type: select
    - disableUnselect: true
      loader: getNodeTopology
      if:
        type: function
        name: isToggleOn|clusterTier/nodeTopology
      label: NodeTopology
      schema: schema/properties/spec/properties/admin/properties/clusterTier/properties/nodeTopology/properties/default
      type: select
    label: Advanced Configuration
    showLabels: true
    type: block-layout
  - description: Enable Backup, Monitoring, TLS etc.
    elements:
    - elements:
      - init:
          type: func
          value: setMonitoring
        label: Enable Monitoring
        watcher:
          func: updateAlertValue
          paths:
            - temp/monitoring
        schema: temp/monitoring
        type: switch
      - customClass: mt-10
        if:
          type: function
          name: showAlerts
        label: Alert Options
        options:
        - text: None
          value: none
        - text: Critical
          value: critical
        - text: Warning
          value: warning
        - text: Info
          value: info
        schema: schema/properties/form/properties/alert/properties/enabled
        type: select
      if:
        type: function
        name: isToggleOn|monitoring
      type: block-layout
    - init: 
        type: func
        value: setBackup
      if: 
        type: function
        name: isToggleOn|backup

      label: Enable Backup?
      watcher:
        func: onBackupSwitch
        paths:
          - temp/backup
      schema: temp/backup
      type: switch
    - elements:
      - disable:
          name: showArchiverAlert
          watchPaths:
            - schema/spec/admin/storageClasses/default
            - schema/spec/mode
        label: Enable Archiver?
        watcher:
          func: onArchiverChange
          paths:
            - schema/properties/spec/properties/admin/properties/archiver/properties/enable/properties/default
        schema: schema/properties/spec/properties/admin/properties/archiver/properties/enable/properties/default
        type: switch
      - if:
          type: function
          name: showArchiverAlert
        label: The selected StorageClass does not support Archiver
        type: warning
      if:
        type: function
        name: showArchiver
      type: block-layout
    - elements:
      - init:
          type: func
          value: checkHostnameOrIP
        if:
          type: function
          name: isToggleOn|tls
        label: Enable TLS?
        watcher:
          func: checkHostnameOrIP
          paths:
            - schema/properties/spec/properties/admin/properties/tls/properties/default
        schema: schema/properties/spec/properties/admin/properties/tls/properties/default
        type: switch
      - loader: getAdminOptions|clusterIssuers
        if:
          type: function
          name: showIssuer
        label: Cluster Issuers
        validation: 
          type: required
        schema: schema/properties/spec/properties/admin/properties/clusterIssuers/properties/default
        type: select
      type: block-layout
    - elements:
      - init: 
          type: func
          value: checkHostnameOrIP
        if: 
          type: function
          name: isToggleOn|expose
        label: Expose via Gateway?
        watcher:
          func: checkHostnameOrIP
          paths:
            - schema/properties/spec/properties/admin/properties/expose/properties/default
        schema: schema/properties/spec/properties/admin/properties/expose/properties/default
        type: switch
      type: block-layout
    if:
      type: function
      name: showAdditionalSettings
    label: Additional Options
    showLabels: true
    type: block-layout
  id: options
  # title: steps.0.label
type: multi-step-form